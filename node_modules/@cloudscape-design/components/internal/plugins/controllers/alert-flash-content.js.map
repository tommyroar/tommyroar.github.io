{"version":3,"file":"alert-flash-content.js","sourceRoot":"","sources":["../../../../../src/internal/plugins/controllers/alert-flash-content.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { ReactNode } from 'react';\n\nimport debounce from '../../debounce';\nimport { reportRuntimeApiWarning } from '../helpers/metrics';\n\n// this code should not depend on React typings, because it is portable between major versions\ninterface RefShim<T> {\n  current: T | null;\n}\n\ninterface AlertFlashContentContext {\n  instanceId: string;\n  type: string;\n  headerRef: RefShim<HTMLElement>;\n  contentRef: RefShim<HTMLElement>;\n}\n\ninterface AlertFlashContentInitialContext {\n  instanceId: string;\n  type: string;\n  header?: ReactNode;\n  content?: ReactNode;\n}\n\nexport type ReplacementType = 'original' | 'remove' | 'replaced';\n\ninterface ReplacementApi {\n  hideHeader(): void;\n  restoreHeader(): void;\n  replaceHeader(replacer: (container: HTMLElement) => void): void;\n  hideContent(): void;\n  restoreContent(): void;\n  replaceContent(replacer: (container: HTMLElement) => void): void;\n}\n\nexport interface AlertFlashContentResult {\n  update: () => void;\n  unmount: (containers: { replacementHeaderContainer: HTMLElement; replacementContentContainer: HTMLElement }) => void;\n}\n\nexport interface AlertFlashContentConfig {\n  id: string;\n  runReplacer: (context: AlertFlashContentContext, replacementApi: ReplacementApi) => AlertFlashContentResult;\n  initialCheck?: (context: AlertFlashContentInitialContext) => boolean;\n}\n\ntype AlertFlashContentRegistrationListener = (provider: AlertFlashContentConfig) => () => void;\n\nexport interface AlertFlashContentApiPublic {\n  registerContentReplacer(config: AlertFlashContentConfig): void;\n  clearRegisteredReplacerForTesting(): void;\n}\n\nexport interface AlertFlashContentApiInternal {\n  onContentRegistered(listener: AlertFlashContentRegistrationListener): () => void;\n  initialCheck(context: AlertFlashContentInitialContext): boolean;\n}\n\nexport class AlertFlashContentController {\n  #listeners: Array<AlertFlashContentRegistrationListener> = [];\n  #cleanups = new Map<AlertFlashContentRegistrationListener, () => void>();\n  #provider?: AlertFlashContentConfig;\n\n  #scheduleUpdate = debounce(\n    () =>\n      this.#listeners.forEach(listener => {\n        if (this.#provider) {\n          const cleanup = listener(this.#provider);\n          this.#cleanups.set(listener, cleanup);\n        }\n      }),\n    0\n  );\n\n  registerContentReplacer = (content: AlertFlashContentConfig) => {\n    if (this.#provider) {\n      reportRuntimeApiWarning(\n        'alert-flash-content',\n        `Cannot call \\`registerContentReplacer\\` with new provider: provider with id \"${this.#provider.id}\" already registered.`\n      );\n      return;\n    }\n    this.#provider = content;\n\n    // Notify existing components if registration happens after the components are rendered.\n    this.#scheduleUpdate();\n  };\n\n  clearRegisteredReplacerForTesting = () => {\n    this.#provider = undefined;\n  };\n\n  initialCheck = (context: AlertFlashContentInitialContext): boolean => {\n    if (this.#provider?.initialCheck) {\n      return this.#provider.initialCheck(context);\n    }\n    return false;\n  };\n\n  onContentRegistered = (listener: AlertFlashContentRegistrationListener) => {\n    if (this.#provider) {\n      const cleanup = listener(this.#provider);\n      this.#listeners.push(listener);\n      this.#cleanups.set(listener, cleanup);\n    } else {\n      this.#listeners.push(listener);\n    }\n    return () => {\n      this.#cleanups.get(listener)?.();\n      this.#listeners = this.#listeners.filter(item => item !== listener);\n      this.#cleanups.delete(listener);\n    };\n  };\n\n  installPublic(api: Partial<AlertFlashContentApiPublic> = {}): AlertFlashContentApiPublic {\n    api.registerContentReplacer ??= this.registerContentReplacer;\n    api.clearRegisteredReplacerForTesting ??= this.clearRegisteredReplacerForTesting;\n    return api as AlertFlashContentApiPublic;\n  }\n\n  installInternal(internalApi: Partial<AlertFlashContentApiInternal> = {}): AlertFlashContentApiInternal {\n    internalApi.onContentRegistered ??= this.onContentRegistered;\n    internalApi.initialCheck ??= this.initialCheck;\n    return internalApi as AlertFlashContentApiInternal;\n  }\n}\n"]}