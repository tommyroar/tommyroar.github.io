{"version":3,"file":"core.js","sourceRoot":"","sources":["../../../../../src/internal/plugins/widget/core.ts"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AAEtC,OAAO,EAAE,uBAAuB,EAAE,MAAM,oBAAoB,CAAC;AAG7D,MAAM,wBAAwB,GAAG,MAAM,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;AAChF,MAAM,yBAAyB,GAAG,MAAM,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;AAClF,MAAM,6BAA6B,GAAG,MAAM,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;AAQjF,MAAM,mBAAmB,GAAG,CAAC,mBAAmB,CAAC,CAAC;AAIlD,SAAS,SAAS;IAChB,OAAO,MAAiC,CAAC;AAC3C,CAAC;AAED,MAAM,UAAU,0BAA0B;IACxC,MAAM,GAAG,GAAG,SAAS,EAAE,CAAC;IACxB,OAAO,GAAG,CAAC,wBAAwB,CAAC,CAAC;AACvC,CAAC;AAED,MAAM,UAAU,2BAA2B;;IACzC,MAAM,eAAe,GAAG,MAAA,SAAS,EAAE,CAAC,yBAAyB,CAAC,mCAAI,EAAE,CAAC;IACrE,SAAS,EAAE,CAAC,yBAAyB,CAAC,GAAG,eAAe,CAAC,MAAM,CAC7D,OAAO,CAAC,EAAE,CAAC,CAAC,mBAAmB,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CACvD,CAAC;IACF,OAAO,eAAe,CAAC;AACzB,CAAC;AAED,MAAM,UAAU,kBAAkB,CAAC,OAAuB;;IACxD,MAAM,GAAG,GAAG,SAAS,EAAE,CAAC;IACxB,GAAG,CAAC,yBAAyB,CAAC,GAAG,MAAA,GAAG,CAAC,yBAAyB,CAAC,mCAAI,EAAE,CAAC;IACtE,GAAG,CAAC,yBAAyB,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC/C,CAAC;AAED,MAAM,UAAU,wBAAwB,CAAC,OAAuB;;IAC9D,MAAM,GAAG,GAAG,SAAS,EAAE,CAAC;IACxB,IAAI,GAAG,CAAC,wBAAwB,CAAC,EAAE,CAAC;QAClC,uBAAuB,CAAC,iBAAiB,EAAE,iEAAiE,CAAC,CAAC;IAChH,CAAC;IACD,GAAG,CAAC,wBAAwB,CAAC,GAAG,OAAO,CAAC;IACxC,MAAA,GAAG,CAAC,6BAA6B,CAAC,0CAAE,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;IACxD,GAAG,CAAC,6BAA6B,CAAC,GAAG,EAAE,CAAC;IACxC,OAAO,GAAG,EAAE;QACV,GAAG,CAAC,wBAAwB,CAAC,GAAG,SAAS,CAAC;IAC5C,CAAC,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,oBAAoB;IAClC,SAAS,EAAE,CAAC,yBAAyB,CAAC,GAAG,SAAS,CAAC;AACrD,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,gBAAgB;IAC9B,OAAO,CAAC,CAAC,0BAA0B,EAAE,CAAC;AACxC,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,kBAAkB;;IAChC,IAAI,gBAAgB,EAAE,EAAE,CAAC;QACvB,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC3B,CAAC;IACD,MAAM,GAAG,GAAG,SAAS,EAAE,CAAC;IACxB,GAAG,CAAC,6BAA6B,CAAC,GAAG,MAAA,GAAG,CAAC,6BAA6B,CAAC,mCAAI,EAAE,CAAC;IAC9E,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE,WAAC,OAAA,MAAA,GAAG,CAAC,6BAA6B,CAAC,0CAAE,IAAI,CAAC,OAAO,CAAC,CAAA,EAAA,CAAC,CAAC;AACnF,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { reportRuntimeApiWarning } from '../helpers/metrics';\nimport { InitialMessage, WidgetMessage } from './interfaces';\n\nconst storageKeyMessageHandler = Symbol.for('awsui-widget-api-message-handler');\nconst storageKeyInitialMessages = Symbol.for('awsui-widget-api-initial-messages');\nconst storageKeyReadyDeferCallbacks = Symbol.for('awsui-widget-api-ready-defer');\n\ninterface WindowWithApi extends Window {\n  [storageKeyMessageHandler]: MessageHandler | undefined;\n  [storageKeyInitialMessages]: Array<InitialMessage> | undefined;\n  [storageKeyReadyDeferCallbacks]: Array<(value?: unknown) => void> | undefined;\n}\n\nconst oneTimeMessageTypes = ['emit-notification'];\n\ntype MessageHandler = (event: WidgetMessage) => void;\n\nfunction getWindow() {\n  return window as Window as WindowWithApi;\n}\n\nexport function getAppLayoutMessageHandler() {\n  const win = getWindow();\n  return win[storageKeyMessageHandler];\n}\n\nexport function getAppLayoutInitialMessages(): Array<InitialMessage> {\n  const initialMessages = getWindow()[storageKeyInitialMessages] ?? [];\n  getWindow()[storageKeyInitialMessages] = initialMessages.filter(\n    message => !oneTimeMessageTypes.includes(message.type)\n  );\n  return initialMessages;\n}\n\nexport function pushInitialMessage(message: InitialMessage) {\n  const win = getWindow();\n  win[storageKeyInitialMessages] = win[storageKeyInitialMessages] ?? [];\n  win[storageKeyInitialMessages].push(message);\n}\n\nexport function registerAppLayoutHandler(handler: MessageHandler) {\n  const win = getWindow();\n  if (win[storageKeyMessageHandler]) {\n    reportRuntimeApiWarning('AppLayoutWidget', 'Double registration attempt, the old handler will be overridden');\n  }\n  win[storageKeyMessageHandler] = handler;\n  win[storageKeyReadyDeferCallbacks]?.forEach(fn => fn());\n  win[storageKeyReadyDeferCallbacks] = [];\n  return () => {\n    win[storageKeyMessageHandler] = undefined;\n  };\n}\n\nexport function clearInitialMessages() {\n  getWindow()[storageKeyInitialMessages] = undefined;\n}\n\n/**\n * Returns whether there is an app layout present on this page or not\n */\nexport function isAppLayoutReady() {\n  return !!getAppLayoutMessageHandler();\n}\n\n/**\n * Returns a promise that resolves once the app layout has loaded\n */\nexport function whenAppLayoutReady() {\n  if (isAppLayoutReady()) {\n    return Promise.resolve();\n  }\n  const win = getWindow();\n  win[storageKeyReadyDeferCallbacks] = win[storageKeyReadyDeferCallbacks] ?? [];\n  return new Promise(resolve => win[storageKeyReadyDeferCallbacks]?.push(resolve));\n}\n"]}