{"version":3,"file":"use-discovered-action.js","sourceRoot":"","sources":["../../../../../src/internal/plugins/helpers/use-discovered-action.tsx"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AACtC,OAAO,KAAK,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAW3D,SAAS,oBAAoB,CAAC,EAAE,YAAY,EAAE,aAAa,EAAE,cAAc,EAAE,OAAO,EAA6B;IAC/G,MAAM,GAAG,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IACzC,MAAM,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;IAEjC,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,UAAU,CAAC,OAAO,IAAI,GAAG,CAAC,OAAO,EAAE,CAAC;YACtC,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAG,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QACxC,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,MAAM,SAAS,GAAG,GAAG,CAAC,OAAQ,CAAC;QAC/B,YAAY,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QACjC,UAAU,CAAC,OAAO,GAAG,IAAI,CAAC;QAC1B,OAAO,GAAG,EAAE;YACV,UAAU,CAAC,OAAO,GAAG,KAAK,CAAC;YAC3B,cAAc,CAAC,SAAS,CAAC,CAAC;QAC5B,CAAC,CAAC;QACF,uDAAuD;IACzD,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,OAAO,6BAAK,GAAG,EAAE,GAAG,GAAQ,CAAC;AAC/B,CAAC;AAED,MAAM,UAAU,yBAAyB,CAAC,kBAAiE;IACzG,OAAO,SAAS,mBAAmB,CAAC,IAAY;QAK9C,MAAM,CAAC,aAAa,EAAE,gBAAgB,CAAC,GAAG,QAAQ,CAAsB,EAAE,CAAC,CAAC;QAC5E,MAAM,SAAS,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;QAC/C,MAAM,UAAU,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;QAEhD,SAAS,CAAC,GAAG,EAAE;YACb,OAAO,kBAAkB,CAAC,OAAO,CAAC,EAAE,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC;QAClE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;QAEX,MAAM,iBAAiB,GAAG,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACpD,oBAAC,oBAAoB,IACnB,GAAG,EAAE,MAAM,CAAC,EAAE,GAAG,GAAG,GAAG,IAAI,EAC3B,OAAO,EAAE;gBACP,IAAI;gBACJ,SAAS;gBACT,UAAU;aACX,EACD,YAAY,EAAE,MAAM,CAAC,YAAY,EACjC,aAAa,EAAE,MAAM,CAAC,aAAa,EACnC,cAAc,EAAE,MAAM,CAAC,cAAc,GACrC,CACH,CAAC,CAAC;QAEH,OAAO,EAAE,iBAAiB,EAAE,SAAS,EAAE,UAAU,EAAE,CAAC;IACtD,CAAC,CAAC;AACJ,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { ActionButtonsController, ActionConfig, ActionContext } from '../controllers/action-buttons';\n\ninterface RuntimeActionWrapperProps {\n  context: ActionContext;\n  mountContent: ActionConfig['mountContent'];\n  updateContent: ActionConfig['updateContent'];\n  unmountContent: ActionConfig['unmountContent'];\n}\n\nfunction RuntimeActionWrapper({ mountContent, updateContent, unmountContent, context }: RuntimeActionWrapperProps) {\n  const ref = useRef<HTMLDivElement>(null);\n  const mountedRef = useRef(false);\n\n  useEffect(() => {\n    if (mountedRef.current && ref.current) {\n      updateContent?.(ref.current, context);\n    }\n  });\n\n  useEffect(() => {\n    const container = ref.current!;\n    mountContent(container, context);\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n      unmountContent(container);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return <div ref={ref}></div>;\n}\n\nexport function createUseDiscoveredAction(onActionRegistered: ActionButtonsController['onActionRegistered']) {\n  return function useDiscoveredAction(type: string): {\n    discoveredActions: React.ReactNode[];\n    headerRef: React.Ref<HTMLDivElement>;\n    contentRef: React.Ref<HTMLDivElement>;\n  } {\n    const [actionConfigs, setActionConfigs] = useState<Array<ActionConfig>>([]);\n    const headerRef = useRef<HTMLDivElement>(null);\n    const contentRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n      return onActionRegistered(actions => setActionConfigs(actions));\n    }, [type]);\n\n    const discoveredActions = actionConfigs.map(action => (\n      <RuntimeActionWrapper\n        key={action.id + '-' + type}\n        context={{\n          type,\n          headerRef,\n          contentRef,\n        }}\n        mountContent={action.mountContent}\n        updateContent={action.updateContent}\n        unmountContent={action.unmountContent}\n      />\n    ));\n\n    return { discoveredActions, headerRef, contentRef };\n  };\n}\n"]}