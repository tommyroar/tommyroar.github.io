{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/internal/components/chart-popover/index.tsx"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AACtC,OAAO,KAAK,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AACjD,OAAO,IAAI,MAAM,MAAM,CAAC;AAExB,OAAO,EAAE,YAAY,EAAE,MAAM,0CAA0C,CAAC;AACxE,OAAO,EAAE,YAAY,EAAE,MAAM,+CAA+C,CAAC;AAE7E,OAAO,WAAW,MAAM,uBAAuB,CAAC;AAChD,OAAO,gBAAgB,MAAM,4BAA4B,CAAC;AAE1D,OAAO,EAAE,YAAY,EAAE,MAAM,sBAAsB,CAAC;AAEpD,OAAO,aAAa,MAAM,gCAAgC,CAAC;AAC3D,OAAO,MAAM,MAAM,iBAAiB,CAAC;AACrC,OAAO,WAAW,MAAM,8BAA8B,CAAC;AA0CvD,eAAe,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;AAE9C,SAAS,YAAY,CACnB,EACE,QAAQ,GAAG,OAAO,EAClB,IAAI,GAAG,QAAQ,EACf,UAAU,GAAG,KAAK,EAClB,aAAa,GAAG,KAAK,EACrB,gBAAgB,EAEhB,QAAQ,EACR,MAAM,EAEN,KAAK,EACL,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,SAAS,EACT,SAAS,EACT,mBAAmB,EAEnB,YAAY,EACZ,YAAY,EACZ,MAAM,EAEN,GAAG,SAAS,EACM,EACpB,GAA2B;IAE3B,MAAM,SAAS,GAAG,YAAY,CAAC,SAAS,CAAC,CAAC;IAC1C,MAAM,gBAAgB,GAAG,MAAM,CAAwB,IAAI,CAAC,CAAC;IAC7D,MAAM,UAAU,GAAG,YAAY,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC;IAEvD,MAAM,YAAY,GAAG,MAAM,CAAgB,IAAI,CAAC,CAAC;IACjD,MAAM,WAAW,GAAG,GAAG,EAAE;QACvB,sDAAsD;QACtD,YAAY,CAAC,OAAO,GAAG,qBAAqB,CAAC,GAAG,EAAE,CAAC,CAAC,YAAY,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC;IACpF,CAAC,CAAC;IAEF,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,gBAAgB,CAAC,OAAO,EAAE,CAAC;YAC7B,MAAM,QAAQ,GAAG,gBAAgB,CAAC,OAAO,CAAC,aAAa,CAAC;YACxD,MAAM,eAAe,GAAG,CAAC,KAAiB,EAAE,EAAE;gBAC5C,mFAAmF;gBACnF,kEAAkE;gBAClE,IAAI,YAAY,CAAC,OAAO,KAAK,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,KAAK,CAAC,MAAiB,CAAC,EAAE,CAAC;oBACvF,SAAS,CAAC,IAAI,CAAC,CAAC;gBAClB,CAAC;YACH,CAAC,CAAC;YAEF,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,eAAe,CAAC,CAAC;YAExD,OAAO,GAAG,EAAE;gBACV,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,eAAe,CAAC,CAAC;YAC7D,CAAC,CAAC;QACJ,CAAC;IACH,CAAC,EAAE,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;IAE3B,oGAAoG;IACpG,MAAM,QAAQ,GAAG,aAAa,CAAC;IAE/B,OAAO,CACL,gCACM,SAAS,EACb,IAAI,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,EAC5C,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,SAAS,CAAC,SAAS,CAAC,EACrE,GAAG,EAAE,UAAU,EACf,YAAY,EAAE,YAAY,EAC1B,YAAY,EAAE,YAAY,EAC1B,WAAW,EAAE,WAAW,EACxB,MAAM,EAAE,MAAM;QACd,6FAA6F;QAC7F,sGAAsG;QACtG,QAAQ,EAAE,CAAC,CAAC;QAEZ,oBAAC,gBAAgB,IACf,IAAI,EAAE,IAAI,EACV,UAAU,EAAE,UAAU,EACtB,QAAQ,EAAE,QAAQ,EAClB,QAAQ,EAAE,QAAQ,EAClB,QAAQ,EAAE,QAAQ,EAClB,QAAQ,EAAE,QAAQ,EAClB,mBAAmB,EAAE,mBAAmB,EACxC,KAAK,EAAE,QAAQ,CAAC,EAAE,CAAC,CACjB,6BAAK,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,aAAa,CAAC,kBAAkB,QAAQ,EAAE,CAAC,CAAC;gBACpF,6BAAK,SAAS,EAAE,aAAa,CAAC,aAAa,CAAC,GAAI;gBAChD,6BAAK,SAAS,EAAE,aAAa,CAAC,aAAa,CAAC,GAAI,CAC5C,CACP,EACD,YAAY,EAAE,IAAI,EAClB,qBAAqB,EAAE,IAAI,EAC3B,gBAAgB,EAAE,QAAQ,EAC1B,SAAS,EAAE,IAAI;YAEf,oBAAC,WAAW,IACV,aAAa,EAAE,aAAa,EAC5B,gBAAgB,EAAE,gBAAgB,EAClC,MAAM,EAAE,8BAAM,SAAS,EAAE,WAAW,CAAC,MAAM,IAAG,KAAK,CAAQ,EAC3D,SAAS,EAAE,SAAS,EACpB,eAAe,EAAC,SAAS,EACzB,SAAS,EAAE,MAAM,CAAC,cAAc,CAAC,EACjC,OAAO,EAAC,OAAO;gBAEf,6BAAK,SAAS,EAAE,WAAW,CAAC,IAAI,IAAG,QAAQ,CAAO;gBACjD,MAAM,IAAI,6BAAK,SAAS,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,IAAG,MAAM,CAAO,CACtE,CACG,CACf,CACP,CAAC;AACJ,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect, useRef } from 'react';\nimport clsx from 'clsx';\n\nimport { nodeContains } from '@cloudscape-design/component-toolkit/dom';\nimport { useMergeRefs } from '@cloudscape-design/component-toolkit/internal';\n\nimport PopoverBody from '../../../popover/body';\nimport PopoverContainer from '../../../popover/container';\nimport { PopoverProps } from '../../../popover/interfaces';\nimport { getBaseProps } from '../../base-component';\n\nimport popoverStyles from '../../../popover/styles.css.js';\nimport styles from './styles.css.js';\nimport testClasses from './test-classes/styles.css.js';\n\nexport interface ChartPopoverProps extends PopoverProps {\n  /** Title of the popover */\n  title?: React.ReactNode;\n\n  /** References the element the container is positioned against. */\n  trackRef?: React.RefObject<HTMLElement | SVGElement>;\n  getTrack?: () => null | HTMLElement | SVGElement;\n  /**\n    Used to update the container position in case track or track position changes:\n    \n    const trackRef = useRef<Element>(null)\n    return (<>\n      <Track style={getPosition(selectedItemId)} ref={trackRef} />\n      <PopoverContainer trackRef={trackRef} trackKey={selectedItemId} .../>\n    </>)\n  */\n  trackKey?: string | number;\n  minVisibleBlockSize?: number;\n\n  /** Optional container element that prevents any clicks in there from dismissing the popover */\n  container: Element | null;\n\n  /** Event that is fired when the popover is dismissed */\n  onDismiss: (outsideClick?: boolean) => void;\n\n  /** Fired when the pointer enters the hoverable area around the popover */\n  onMouseEnter?: (event: React.MouseEvent) => void;\n\n  /** Fired when the pointer leaves the hoverable area around the popover */\n  onMouseLeave?: (event: React.MouseEvent) => void;\n\n  onBlur?: (event: React.FocusEvent) => void;\n\n  /** Popover content */\n  children?: React.ReactNode;\n\n  /** Popover footer */\n  footer?: React.ReactNode;\n}\n\nexport default React.forwardRef(ChartPopover);\n\nfunction ChartPopover(\n  {\n    position = 'right',\n    size = 'medium',\n    fixedWidth = false,\n    dismissButton = false,\n    dismissAriaLabel,\n\n    children,\n    footer,\n\n    title,\n    trackRef,\n    getTrack,\n    trackKey,\n    onDismiss,\n    container,\n    minVisibleBlockSize,\n\n    onMouseEnter,\n    onMouseLeave,\n    onBlur,\n\n    ...restProps\n  }: ChartPopoverProps,\n  ref: React.Ref<HTMLElement>\n) {\n  const baseProps = getBaseProps(restProps);\n  const popoverObjectRef = useRef<HTMLDivElement | null>(null);\n  const popoverRef = useMergeRefs(popoverObjectRef, ref);\n\n  const clickFrameId = useRef<number | null>(null);\n  const onMouseDown = () => {\n    // Indicate there was a click inside popover recently.\n    clickFrameId.current = requestAnimationFrame(() => (clickFrameId.current = null));\n  };\n\n  useEffect(() => {\n    if (popoverObjectRef.current) {\n      const document = popoverObjectRef.current.ownerDocument;\n      const onDocumentClick = (event: MouseEvent) => {\n        // Dismiss popover unless there was a click inside within the last animation frame.\n        // Ignore clicks inside the chart as those are handled separately.\n        if (clickFrameId.current === null && !nodeContains(container, event.target as Element)) {\n          onDismiss(true);\n        }\n      };\n\n      document.addEventListener('mousedown', onDocumentClick);\n\n      return () => {\n        document.removeEventListener('mousedown', onDocumentClick);\n      };\n    }\n  }, [container, onDismiss]);\n\n  // In chart popovers, dismiss button is present when they are pinned, so both values are equivalent.\n  const isPinned = dismissButton;\n\n  return (\n    <div\n      {...baseProps}\n      role={!dismissButton ? 'tooltip' : undefined}\n      className={clsx(popoverStyles.root, styles.root, baseProps.className)}\n      ref={popoverRef}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseDown={onMouseDown}\n      onBlur={onBlur}\n      // The tabIndex makes it so that clicking inside popover assigns this element as blur target.\n      // That is necessary in charts to ensure the blur target is within the chart and no cleanup is needed.\n      tabIndex={-1}\n    >\n      <PopoverContainer\n        size={size}\n        fixedWidth={fixedWidth}\n        position={position}\n        trackRef={trackRef}\n        getTrack={getTrack}\n        trackKey={trackKey}\n        minVisibleBlockSize={minVisibleBlockSize}\n        arrow={position => (\n          <div className={clsx(popoverStyles.arrow, popoverStyles[`arrow-position-${position}`])}>\n            <div className={popoverStyles['arrow-outer']} />\n            <div className={popoverStyles['arrow-inner']} />\n          </div>\n        )}\n        keepPosition={true}\n        allowVerticalOverflow={true}\n        allowScrollToFit={isPinned}\n        hoverArea={true}\n      >\n        <PopoverBody\n          dismissButton={dismissButton}\n          dismissAriaLabel={dismissAriaLabel}\n          header={<span className={testClasses.header}>{title}</span>}\n          onDismiss={onDismiss}\n          overflowVisible=\"content\"\n          className={styles['popover-body']}\n          variant=\"chart\"\n        >\n          <div className={testClasses.body}>{children}</div>\n          {footer && <div className={clsx(testClasses.footer, styles.footer)}>{footer}</div>}\n        </PopoverBody>\n      </PopoverContainer>\n    </div>\n  );\n}\n"]}