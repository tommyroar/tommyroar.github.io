{"version":3,"file":"styles-check.js","sourceRoot":"","sources":["../../../../../src/internal/hooks/use-base-component/styles-check.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect } from 'react';\n\nimport { GIT_SHA, PACKAGE_VERSION, THEME } from '../../environment';\nimport { metrics } from '../../metrics';\n\nexport function checkMissingStyles(ownerDocument: Document) {\n  if (!ownerDocument.defaultView) {\n    // skip the check if this iframe is detached\n    return;\n  }\n  const result = getComputedStyle(ownerDocument.body).getPropertyValue(`--awsui-version-info-${GIT_SHA}`);\n  if (!result) {\n    console.error(`Missing AWS-UI CSS for theme \"${THEME}\", version \"${PACKAGE_VERSION}\", and git sha \"${GIT_SHA}\".`);\n    metrics.sendOpsMetricObject('awsui-missing-css-asset', {});\n  }\n}\n\nfunction documentReady(document: Document, callback: () => void) {\n  if (document.readyState === 'complete') {\n    callback();\n  } else {\n    document.defaultView?.addEventListener('load', () => callback(), { once: true });\n  }\n}\n\nexport function documentReadyAndIdle(document: Document, signal: AbortSignal) {\n  return new Promise<void>((resolve, reject) => {\n    signal.addEventListener('abort', () => reject(new DOMException('Aborted', 'AbortError')));\n    documentReady(document, () => {\n      setTimeout(() => {\n        requestIdleCallback(() => resolve());\n      }, 1000);\n    });\n  });\n}\n\nconst checkedDocs = new WeakMap<Document, boolean>();\nconst checkMissingStylesOnce = (document: Document) => {\n  const checked = checkedDocs.get(document);\n  if (!checked) {\n    checkMissingStyles(document);\n    checkedDocs.set(document, true);\n  }\n};\n\nexport function useMissingStylesCheck(elementRef: React.RefObject<HTMLElement>) {\n  useEffect(() => {\n    // if idle callbacks not supported, we simply do not collect the metric\n    if (typeof requestIdleCallback !== 'function') {\n      return;\n    }\n    const ownerDocument = elementRef.current?.ownerDocument ?? document;\n    const abortController = new AbortController();\n    documentReadyAndIdle(ownerDocument, abortController.signal).then(\n      () => checkMissingStylesOnce(ownerDocument),\n      error => {\n        // istanbul ignore next\n        if (error.name !== 'AbortError') {\n          throw error;\n        }\n      }\n    );\n    return () => abortController.abort();\n  }, [elementRef]);\n}\n"]}