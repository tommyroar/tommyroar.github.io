{"version":3,"file":"basic-table.js","sourceRoot":"","sources":["../../../../src/s3-resource-selector/s3-modal/basic-table.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { useCollection } from '@cloudscape-design/collection-hooks';\nimport { useStableCallback } from '@cloudscape-design/component-toolkit/internal';\n\nimport { InternalButton } from '../../button/internal';\nimport InternalHeader from '../../header/internal';\nimport { ComponentFormatFunction } from '../../i18n/context';\nimport useForwardFocus, { ForwardFocusRef } from '../../internal/hooks/forward-focus';\nimport formatDateLocalized from '../../internal/utils/date-time/format-date-localized';\nimport InternalLiveRegion from '../../live-region/internal';\nimport { PaginationProps } from '../../pagination/interfaces';\nimport InternalPagination from '../../pagination/internal';\nimport InternalSpaceBetween from '../../space-between/internal';\nimport { TableProps } from '../../table/interfaces';\nimport InternalTable from '../../table/internal';\nimport { TextFilterProps } from '../../text-filter/interfaces';\nimport InternalTextFilter from '../../text-filter/internal';\nimport { S3ResourceSelectorProps } from '../interfaces';\nimport { EmptyState } from './empty-state';\n\nimport styles from './styles.css.js';\n\ninterface BasicS3TableStrings<T> {\n  labelRefresh?: string;\n  labelsPagination?: PaginationProps.Labels;\n  header?: string;\n  loadingText?: string;\n  filteringPlaceholder?: string;\n  filteringAriaLabel?: string;\n  filteringClearAriaLabel?: string;\n  filteringCounterText?: S3ResourceSelectorProps.I18nStrings['filteringCounterText'];\n  lastUpdatedText?: string;\n  emptyText?: string;\n  noMatchTitle?: string;\n  noMatchSubtitle?: string;\n  clearFilterButtonText?: string;\n  selectionLabels?: TableProps.AriaLabels<T>;\n}\n\ninterface BasicS3TableProps<T> {\n  // We do not use idiomatic `ref` prop because it does not allow generics.\n  // Option 3 from this solution: https://stackoverflow.com/a/58473012/1297743\n  forwardFocusRef: React.Ref<ForwardFocusRef>;\n  columnDefinitions: ReadonlyArray<TableProps.ColumnDefinition<T>>;\n  fetchData: () => Promise<ReadonlyArray<T>>;\n  trackBy: TableProps.TrackBy<T>;\n  i18nStrings: BasicS3TableStrings<T>;\n  isVisualRefresh?: boolean;\n  visibleColumns: ReadonlyArray<string>;\n  isItemDisabled: TableProps.IsItemDisabled<T> | undefined;\n  onSelect: (item: T | undefined) => void;\n}\n\nexport function getSharedI18Strings(\n  i18n: ComponentFormatFunction<'s3-resource-selector'>,\n  i18nStrings: S3ResourceSelectorProps.I18nStrings | undefined\n): BasicS3TableStrings<unknown> {\n  return {\n    filteringCounterText: i18n(\n      'i18nStrings.filteringCounterText',\n      i18nStrings?.filteringCounterText,\n      format => count => format({ count })\n    ),\n    labelRefresh: i18n('i18nStrings.labelRefresh', i18nStrings?.labelRefresh),\n    labelsPagination: i18nStrings?.labelsPagination,\n    noMatchTitle: i18n('i18nStrings.filteringNoMatches', i18nStrings?.filteringNoMatches),\n    noMatchSubtitle: i18n('i18nStrings.filteringCantFindMatch', i18nStrings?.filteringCantFindMatch),\n    clearFilterButtonText: i18n('i18nStrings.clearFilterButtonText', i18nStrings?.clearFilterButtonText),\n    filteringClearAriaLabel: i18nStrings?.labelClearFilter,\n    lastUpdatedText: i18n('i18nStrings.modalLastUpdatedText', i18nStrings?.modalLastUpdatedText),\n  };\n}\n\nexport function BasicS3Table<T>({\n  forwardFocusRef,\n  columnDefinitions,\n  fetchData,\n  trackBy,\n  i18nStrings = {},\n  isVisualRefresh,\n  visibleColumns,\n  isItemDisabled,\n  onSelect,\n}: BasicS3TableProps<T>) {\n  const [loading, setLoading] = useState(false);\n  const [allItems, setAllItems] = useState<ReadonlyArray<T>>([]);\n  const [lastUpdated, setLastUpdated] = useState<Date>();\n  const textFilterRef = useRef<TextFilterProps.Ref>(null);\n  const onSelectLatest = useStableCallback(onSelect);\n\n  function loadData() {\n    setLoading(true);\n    return fetchData()\n      .then(items => {\n        setAllItems(items);\n        setLoading(false);\n      })\n      .catch(() => {\n        // error handling should happen on the customer side, outside of this component\n        setLoading(false);\n      });\n  }\n\n  async function reloadData() {\n    await loadData();\n    setLastUpdated(new Date());\n  }\n\n  useEffect(() => {\n    loadData();\n    // Data loading is only happening on initial render, or via refresh button\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useForwardFocus(forwardFocusRef, textFilterRef);\n\n  const { items, filteredItemsCount, collectionProps, filterProps, paginationProps, actions } = useCollection(\n    allItems,\n    {\n      selection: { trackBy },\n      filtering: {\n        empty: i18nStrings.emptyText,\n        noMatch: (\n          <EmptyState\n            title={i18nStrings.noMatchTitle}\n            subtitle={i18nStrings.noMatchSubtitle}\n            action={\n              <InternalButton onClick={() => actions.setFiltering('')}>\n                {i18nStrings.clearFilterButtonText}\n              </InternalButton>\n            }\n          />\n        ),\n      },\n      pagination: {},\n      sorting: {},\n    }\n  );\n  const selectedItem = collectionProps.selectedItems?.[0];\n\n  // selectedItem can change internally inside the hook after pagination or filtering\n  // useEffect will capture all possible changes\n  useEffect(() => {\n    onSelectLatest(selectedItem);\n  }, [selectedItem, onSelectLatest]);\n\n  return (\n    <InternalTable<T>\n      variant={isVisualRefresh ? 'borderless' : 'container'}\n      {...collectionProps}\n      header={\n        <InternalHeader\n          variant={isVisualRefresh ? 'h3' : 'h2'}\n          headingTagOverride={'h3'}\n          actions={\n            <InternalHeaderActions<T> reloadData={reloadData} i18nStrings={i18nStrings} lastUpdated={lastUpdated} />\n          }\n          counter={selectedItem ? `(1/${allItems.length})` : `(${allItems.length})`}\n        >\n          {i18nStrings.header}\n        </InternalHeader>\n      }\n      trackBy={trackBy}\n      filter={\n        <InternalTextFilter\n          {...filterProps}\n          ref={textFilterRef}\n          filteringAriaLabel={i18nStrings.filteringAriaLabel}\n          filteringClearAriaLabel={i18nStrings.filteringClearAriaLabel}\n          filteringPlaceholder={i18nStrings.filteringPlaceholder}\n          countText={i18nStrings.filteringCounterText ? i18nStrings.filteringCounterText(filteredItemsCount!) : ''}\n        />\n      }\n      pagination={<InternalPagination {...paginationProps} ariaLabels={i18nStrings.labelsPagination} />}\n      selectionType=\"single\"\n      ariaLabels={i18nStrings.selectionLabels}\n      loading={loading}\n      loadingText={i18nStrings.loadingText}\n      items={items}\n      visibleColumns={visibleColumns}\n      isItemDisabled={isItemDisabled}\n      columnDefinitions={columnDefinitions}\n      enableKeyboardNavigation={true}\n    />\n  );\n}\n\ninterface InternalHeaderActionsProps<T> {\n  reloadData: () => void;\n  i18nStrings: BasicS3TableProps<T>['i18nStrings'];\n  lastUpdated: Date | undefined;\n}\n\nfunction InternalHeaderActions<T>({ i18nStrings, reloadData, lastUpdated }: InternalHeaderActionsProps<T>) {\n  function getLastUpdated() {\n    if (!lastUpdated || !i18nStrings.lastUpdatedText) {\n      return null;\n    }\n\n    const formattedDate = formatDateLocalized({\n      date: lastUpdated.toString(),\n      isDateOnly: false,\n      isMonthOnly: false,\n    });\n\n    return (\n      <div className={styles['last-updated-caption']}>\n        {i18nStrings.lastUpdatedText}\n        <br />\n        {formattedDate}\n        <InternalLiveRegion tagName=\"span\" sources={[i18nStrings.lastUpdatedText, formattedDate]} />\n      </div>\n    );\n  }\n\n  return (\n    <InternalSpaceBetween size=\"s\" direction=\"horizontal\" alignItems=\"center\">\n      {getLastUpdated()}\n      <InternalButton iconName=\"refresh\" ariaLabel={i18nStrings.labelRefresh} onClick={reloadData} />\n    </InternalSpaceBetween>\n  );\n}\n"]}