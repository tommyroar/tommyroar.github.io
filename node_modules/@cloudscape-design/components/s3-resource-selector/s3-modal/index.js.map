{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/s3-resource-selector/s3-modal/index.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useReducer, useRef } from 'react';\n\nimport { BreadcrumbGroupImplementation } from '../../breadcrumb-group/implementation';\nimport { InternalButton } from '../../button/internal';\nimport { useInternalI18n } from '../../i18n/context';\nimport { ForwardFocusRef } from '../../internal/hooks/forward-focus';\nimport { useEffectOnUpdate } from '../../internal/hooks/use-effect-on-update';\nimport { useVisualRefresh } from '../../internal/hooks/use-visual-mode';\nimport { assertNever } from '../../internal/types';\nimport InternalModal from '../../modal/internal';\nimport InternalSpaceBetween from '../../space-between/internal';\nimport { S3ResourceSelectorProps } from '../interfaces';\nimport { joinObjectPath } from '../utils';\nimport { BucketsTable } from './buckets-table';\nimport { ObjectsTable } from './objects-table';\nimport { VersionsTable } from './versions-table';\n\nimport testUtilStyles from '../test-classes/styles.css.js';\nimport styles from './styles.css.js';\n\nexport interface S3ModalProps {\n  alert: React.ReactNode;\n  selectableItemsTypes: S3ResourceSelectorProps['selectableItemsTypes'];\n  fetchBuckets: S3ResourceSelectorProps['fetchBuckets'];\n  bucketsVisibleColumns: ReadonlyArray<string>;\n  bucketsIsItemDisabled: S3ResourceSelectorProps['bucketsIsItemDisabled'];\n  fetchObjects: S3ResourceSelectorProps['fetchObjects'];\n  objectsVisibleColumns: ReadonlyArray<string>;\n  objectsIsItemDisabled: S3ResourceSelectorProps['objectsIsItemDisabled'];\n  fetchVersions: S3ResourceSelectorProps['fetchVersions'];\n  versionsVisibleColumns: ReadonlyArray<string>;\n  versionsIsItemDisabled: S3ResourceSelectorProps['versionsIsItemDisabled'];\n  i18nStrings: S3ResourceSelectorProps.I18nStrings | undefined;\n  getModalRoot: S3ResourceSelectorProps['getModalRoot'];\n  removeModalRoot: S3ResourceSelectorProps['removeModalRoot'];\n  onDismiss: () => void;\n  onSubmit: (resource: S3ResourceSelectorProps.Resource) => void;\n}\n\ninterface S3BrowseState {\n  selectedItem: string | null;\n  currentView: 'buckets' | 'objects' | 'versions';\n  breadcrumbs: ReadonlyArray<string>;\n}\n\ntype S3BrowseActions =\n  | { type: 'browse-buckets' }\n  | { type: 'browse-objects' | 'browse-versions'; breadcrumbs: S3BrowseState['breadcrumbs'] }\n  | { type: 'select-item'; item: string };\n\nconst initialBrowseState: S3BrowseState = {\n  selectedItem: null,\n  currentView: 'buckets',\n  breadcrumbs: [],\n};\n\nfunction s3BrowseReducer(state: S3BrowseState, action: S3BrowseActions) {\n  switch (action.type) {\n    case 'browse-buckets':\n      return initialBrowseState;\n    case 'browse-objects':\n      return {\n        selectedItem: null,\n        currentView: 'objects' as const,\n        breadcrumbs: action.breadcrumbs,\n      };\n    case 'browse-versions':\n      return {\n        selectedItem: null,\n        currentView: 'versions' as const,\n        breadcrumbs: action.breadcrumbs,\n      };\n    case 'select-item':\n      return {\n        ...state,\n        selectedItem: action.item,\n      };\n    default:\n      assertNever(action);\n  }\n  return state;\n}\n\nfunction createResourceInfo({ currentView, breadcrumbs, selectedItem }: S3BrowseState) {\n  const prefix = 's3://';\n  if (currentView === 'versions') {\n    return { uri: prefix + joinObjectPath(breadcrumbs), versionId: selectedItem ?? undefined };\n  }\n  return { uri: prefix + joinObjectPath([...breadcrumbs, selectedItem!]) };\n}\n\nexport function S3Modal({\n  i18nStrings,\n  alert,\n  selectableItemsTypes,\n  fetchBuckets,\n  bucketsVisibleColumns,\n  bucketsIsItemDisabled,\n  fetchObjects,\n  objectsVisibleColumns,\n  objectsIsItemDisabled,\n  fetchVersions,\n  versionsVisibleColumns,\n  versionsIsItemDisabled,\n  getModalRoot,\n  removeModalRoot,\n  onSubmit,\n  onDismiss,\n}: S3ModalProps) {\n  const [{ currentView, breadcrumbs, selectedItem }, dispatch] = useReducer(s3BrowseReducer, initialBrowseState);\n  const forwardFocusRef = useRef<ForwardFocusRef>(null);\n  const i18n = useInternalI18n('s3-resource-selector');\n\n  const isVisualRefresh = useVisualRefresh();\n\n  useEffectOnUpdate(() => {\n    forwardFocusRef.current?.focus();\n  }, [breadcrumbs]);\n\n  return (\n    <div>\n      <InternalModal\n        className={testUtilStyles['modal-root']}\n        visible={true}\n        size=\"max\"\n        getModalRoot={getModalRoot}\n        removeModalRoot={removeModalRoot}\n        closeAriaLabel={i18nStrings?.labelModalDismiss}\n        onDismiss={onDismiss}\n        header={i18n('i18nStrings.modalTitle', i18nStrings?.modalTitle)}\n        footer={\n          <InternalSpaceBetween className={styles['modal-actions']} size=\"xs\" direction=\"horizontal\">\n            <InternalButton variant=\"link\" formAction=\"none\" onClick={onDismiss}>\n              {i18n('i18nStrings.modalCancelButton', i18nStrings?.modalCancelButton)}\n            </InternalButton>\n            <InternalButton\n              variant=\"primary\"\n              className={styles['submit-button']}\n              disabled={!selectedItem}\n              formAction=\"none\"\n              onClick={() => onSubmit(createResourceInfo({ currentView, breadcrumbs, selectedItem }))}\n            >\n              {i18n('i18nStrings.modalSubmitButton', i18nStrings?.modalSubmitButton)}\n            </InternalButton>\n          </InternalSpaceBetween>\n        }\n      >\n        <InternalSpaceBetween size={isVisualRefresh ? 'xxs' : 'xs'}>\n          <BreadcrumbGroupImplementation\n            ariaLabel={i18n('i18nStrings.labelBreadcrumbs', i18nStrings?.labelBreadcrumbs)}\n            expandAriaLabel={i18nStrings?.labelExpandBreadcrumbs}\n            onFollow={event => {\n              event.preventDefault();\n              event.detail.item.meta.onClick();\n            }}\n            items={[\n              {\n                text: i18n('i18nStrings.modalBreadcrumbRootItem', i18nStrings?.modalBreadcrumbRootItem) ?? '',\n                href: '',\n                meta: { onClick: () => dispatch({ type: 'browse-buckets' }) },\n              },\n              ...breadcrumbs.map((segment, index) => ({\n                text: segment,\n                href: '',\n                meta: {\n                  onClick: () =>\n                    dispatch({\n                      type: 'browse-objects',\n                      breadcrumbs: breadcrumbs.slice(0, index + 1),\n                    }),\n                },\n              })),\n            ]}\n          />\n          {alert}\n          {currentView === 'buckets' ? (\n            <BucketsTable\n              forwardFocusRef={forwardFocusRef}\n              fetchData={fetchBuckets}\n              visibleColumns={bucketsVisibleColumns}\n              isItemDisabled={bucketsIsItemDisabled}\n              selectableItemsTypes={selectableItemsTypes}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onDrilldown={path =>\n                dispatch({\n                  type: 'browse-objects',\n                  breadcrumbs: [path],\n                })\n              }\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : currentView === 'objects' ? (\n            <ObjectsTable\n              forwardFocusRef={forwardFocusRef}\n              pathSegments={breadcrumbs}\n              fetchData={fetchObjects}\n              visibleColumns={objectsVisibleColumns}\n              isItemDisabled={objectsIsItemDisabled}\n              selectableItemsTypes={selectableItemsTypes}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onDrilldown={item => {\n                dispatch({\n                  type: item.IsFolder ? 'browse-objects' : 'browse-versions',\n                  breadcrumbs: [...breadcrumbs, item.Key!],\n                });\n              }}\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : currentView === 'versions' ? (\n            <VersionsTable\n              forwardFocusRef={forwardFocusRef}\n              pathSegments={breadcrumbs}\n              fetchData={fetchVersions}\n              visibleColumns={versionsVisibleColumns}\n              isItemDisabled={versionsIsItemDisabled}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : (\n            assertNever(currentView)\n          )}\n        </InternalSpaceBetween>\n      </InternalModal>\n    </div>\n  );\n}\n"]}