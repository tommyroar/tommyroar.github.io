{"version":3,"file":"use-multiselect.js","sourceRoot":"","sources":["../../../src/multiselect/use-multiselect.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport { warnOnce } from '@cloudscape-design/component-toolkit/internal';\n\nimport { useInternalI18n } from '../i18n/context';\nimport { DropdownStatusProps, useDropdownStatus } from '../internal/components/dropdown-status';\nimport { DropdownOption, OptionDefinition, OptionGroup } from '../internal/components/option/interfaces';\nimport { isGroup } from '../internal/components/option/utils/filter-options';\nimport { prepareOptions } from '../internal/components/option/utils/prepare-options';\nimport { fireNonCancelableEvent } from '../internal/events';\nimport { SomeRequired } from '../internal/types';\nimport { joinStrings } from '../internal/utils/strings';\nimport { SelectListProps } from '../select/parts/plain-list';\nimport { checkOptionValueField } from '../select/utils/check-option-value-field.js';\nimport { findOptionIndex } from '../select/utils/connect-options';\nimport { useAnnouncement } from '../select/utils/use-announcement';\nimport { useLoadItems } from '../select/utils/use-load-items';\nimport { useNativeSearch } from '../select/utils/use-native-search';\nimport { useSelect } from '../select/utils/use-select';\nimport { TokenGroupProps } from '../token-group/interfaces';\nimport { MultiselectProps } from './interfaces';\n\ntype UseMultiselectOptions = SomeRequired<\n  Pick<\n    MultiselectProps,\n    | 'options'\n    | 'selectedOptions'\n    | 'filteringType'\n    | 'filteringResultsText'\n    | 'disabled'\n    | 'noMatch'\n    | 'renderHighlightedAriaLive'\n    | 'deselectAriaLabel'\n    | 'keepOpen'\n    | 'onBlur'\n    | 'onFocus'\n    | 'onLoadItems'\n    | 'onChange'\n    | 'selectedAriaLabel'\n    | 'enableSelectAll'\n    | 'i18nStrings'\n  > &\n    DropdownStatusProps & {\n      controlId?: string;\n      ariaLabelId: string;\n      footerId: string;\n      filteringValue: string;\n      setFilteringValue?: (value: string) => void;\n      externalRef: React.Ref<MultiselectProps.Ref>;\n    },\n  'options' | 'selectedOptions' | 'filteringType' | 'statusType' | 'keepOpen'\n> & { embedded?: boolean };\n\nexport function useMultiselect({\n  options,\n  filteringType,\n  filteringResultsText,\n  disabled,\n  statusType,\n  empty,\n  loadingText,\n  finishedText,\n  errorText,\n  noMatch,\n  renderHighlightedAriaLive,\n  selectedOptions,\n  deselectAriaLabel,\n  keepOpen,\n  onBlur,\n  onFocus,\n  onLoadItems,\n  onChange,\n  controlId,\n  ariaLabelId,\n  footerId,\n  filteringValue,\n  setFilteringValue,\n  externalRef,\n  embedded,\n  enableSelectAll,\n  i18nStrings,\n  ...restProps\n}: UseMultiselectOptions) {\n  checkOptionValueField('Multiselect', 'options', options);\n\n  const i18n = useInternalI18n('multiselect');\n  const i18nCommon = useInternalI18n('select');\n  const recoveryText = i18nCommon('recoveryText', restProps.recoveryText);\n  const errorIconAriaLabel = i18nCommon('errorIconAriaLabel', restProps.errorIconAriaLabel);\n  const selectedAriaLabel = i18nCommon('selectedAriaLabel', restProps.selectedAriaLabel);\n\n  if (restProps.recoveryText && !onLoadItems) {\n    warnOnce('Multiselect', '`onLoadItems` must be provided for `recoveryText` to be displayed.');\n  }\n\n  const { handleLoadMore, handleRecoveryClick, fireLoadItems } = useLoadItems({\n    onLoadItems,\n    options,\n    statusType,\n  });\n  const useInteractiveGroups = true;\n  const { flatOptions, filteredOptions, parentMap, totalCount, matchesCount } = prepareOptions(\n    options,\n    filteringType,\n    filteringValue\n  );\n\n  const selectAllOption: DropdownOption = {\n    type: 'select-all',\n    afterHeader: filteringType !== 'none',\n    option: { label: i18n('i18nStrings.selectAllText', i18nStrings?.selectAllText) },\n  };\n\n  const visibleOptions =\n    enableSelectAll && filteredOptions.length ? [selectAllOption, ...filteredOptions] : filteredOptions;\n\n  // Includes visible and non-visible (filtered out) options\n  const allNonParentOptions = flatOptions.filter(item => item.type !== 'parent').map(option => option.option);\n\n  const filteredNonParentOptions = filteredOptions.filter(item => item.type !== 'parent').map(item => item.option);\n\n  const selectedValues = useMemo(() => new Set(selectedOptions.map(option => option.value)), [selectedOptions]);\n\n  const isSomeSelected = selectedOptions.length > 0;\n  const isAllVisibleSelectableSelected =\n    isSomeSelected && filteredNonParentOptions.every(option => option.disabled || selectedValues.has(option.value));\n  const isAllSelected = allNonParentOptions.every(option => selectedValues.has(option.value));\n\n  const toggleAll = () => {\n    const filteredNonParentOptionValues = new Set(filteredNonParentOptions.map(option => option.value));\n    fireNonCancelableEvent(onChange, {\n      selectedOptions: isAllVisibleSelectableSelected\n        ? selectedOptions.filter(option => !filteredNonParentOptionValues.has(option.value))\n        : allNonParentOptions.filter(\n            ({ disabled, value }) =>\n              selectedValues.has(value) || (!disabled && filteredNonParentOptionValues.has(value))\n          ),\n    });\n  };\n\n  const updateSelectedOption = useCallback(\n    (option: OptionDefinition | OptionGroup) => {\n      // switch between selection and deselection behavior, ignores disabled options to prevent\n      // getting stuck on one behavior when an option is disabled and its state cannot be changed\n      const isAllChildrenSelected = (optionsArray: OptionDefinition[]) =>\n        optionsArray.every(item => findOptionIndex(selectedOptions, item) > -1 || item.disabled);\n      const intersection = (visibleOptions: OptionDefinition[], options: OptionDefinition[]) =>\n        visibleOptions.filter(item => findOptionIndex(options, item) > -1 && !item.disabled);\n      const union = (visibleOptions: OptionDefinition[], options: OptionDefinition[]) =>\n        visibleOptions.filter(item => findOptionIndex(options, item) === -1).concat(options);\n      const select = (options: OptionDefinition[], selectedOptions: OptionDefinition[]) => {\n        return union(selectedOptions, options);\n      };\n      const unselect = (options: OptionDefinition[], selectedOptions: OptionDefinition[]) => {\n        return selectedOptions.filter(option => findOptionIndex(options, option) === -1);\n      };\n      let newSelectedOptions = [...selectedOptions];\n\n      if (isGroup(option)) {\n        const visibleOptions = intersection([...option.options], filteredNonParentOptions);\n        newSelectedOptions = isAllChildrenSelected(visibleOptions)\n          ? unselect(visibleOptions, newSelectedOptions)\n          : select(visibleOptions, newSelectedOptions);\n      } else {\n        newSelectedOptions = isAllChildrenSelected([option])\n          ? unselect([option], newSelectedOptions)\n          : select([option], newSelectedOptions);\n      }\n\n      fireNonCancelableEvent(onChange, {\n        selectedOptions: newSelectedOptions,\n      });\n    },\n    [selectedOptions, onChange, filteredNonParentOptions]\n  );\n\n  const scrollToIndex = useRef<SelectListProps.SelectListRef>(null);\n  const {\n    isOpen,\n    highlightType,\n    highlightedOption,\n    highlightedIndex,\n    getTriggerProps,\n    getDropdownProps,\n    getFilterProps,\n    getMenuProps,\n    getOptionProps,\n    highlightOption,\n    announceSelected,\n    focusActiveRef,\n  } = useSelect({\n    selectedOptions,\n    updateSelectedOption,\n    options: visibleOptions,\n    filteringType,\n    onFocus,\n    onBlur,\n    externalRef,\n    keepOpen,\n    fireLoadItems,\n    setFilteringValue,\n    useInteractiveGroups,\n    statusType,\n    embedded,\n    isAllSelected,\n    isSomeSelected,\n    toggleAll,\n  });\n\n  const wrapperOnKeyDown = useNativeSearch({\n    isEnabled: filteringType === 'none' && isOpen,\n    options: visibleOptions,\n    highlightOption: highlightOption,\n    highlightedOption: highlightedOption?.option,\n    useInteractiveGroups,\n  });\n\n  const isEmpty = !options || options.length === 0;\n  const isNoMatch = filteredOptions && filteredOptions.length === 0;\n  const isFiltered =\n    filteringType !== 'none' && filteringValue.length > 0 && filteredOptions && filteredOptions.length > 0;\n  const filteredText = isFiltered ? filteringResultsText?.(matchesCount, totalCount) : undefined;\n  const dropdownStatus = useDropdownStatus({\n    statusType,\n    empty,\n    loadingText,\n    finishedText,\n    errorText,\n    recoveryText,\n    isEmpty,\n    isNoMatch,\n    noMatch,\n    filteringResultsText: filteredText,\n    onRecoveryClick: () => {\n      handleRecoveryClick();\n      focusActiveRef();\n    },\n    errorIconAriaLabel: errorIconAriaLabel,\n    hasRecoveryCallback: !!onLoadItems,\n  });\n\n  const announcement = useAnnouncement({\n    announceSelected,\n    highlightedOption,\n    getParent: option => parentMap.get(option)?.option as undefined | OptionGroup,\n    selectedAriaLabel,\n    renderHighlightedAriaLive,\n  });\n\n  const tokens: TokenGroupProps['items'] = selectedOptions.map(option => ({\n    label: option.label,\n    disabled: disabled || option.disabled,\n    labelTag: option.labelTag,\n    description: option.description,\n    iconAlt: option.iconAlt,\n    iconName: option.iconName,\n    iconUrl: option.iconUrl,\n    iconSvg: option.iconSvg,\n    tags: option.tags,\n    dismissLabel: i18n('deselectAriaLabel', deselectAriaLabel?.(option), format =>\n      format({ option__label: option.label ?? '' })\n    ),\n  }));\n\n  useEffect(() => {\n    scrollToIndex.current?.(highlightedIndex);\n  }, [highlightedIndex]);\n\n  const dropdownOnMouseDown = (event: React.MouseEvent) => {\n    const target = event.target as HTMLElement;\n\n    if (target !== document.activeElement) {\n      // prevent currently focused element from losing it\n      event.preventDefault();\n    }\n  };\n\n  const tokenOnDismiss: TokenGroupProps['onDismiss'] = ({ detail }) => {\n    const optionToDeselect = selectedOptions[detail.itemIndex];\n    updateSelectedOption(optionToDeselect);\n    const targetRef = getTriggerProps().ref;\n    if (targetRef.current) {\n      targetRef.current.focus();\n    }\n  };\n\n  return {\n    isOpen,\n    tokens,\n    announcement,\n    dropdownStatus,\n    filteringValue,\n    filteredOptions: visibleOptions,\n    highlightType,\n    scrollToIndex,\n    getFilterProps,\n    getTriggerProps,\n    getMenuProps: () => ({\n      ...getMenuProps(),\n      onLoadMore: handleLoadMore,\n      ariaLabelledby: joinStrings(ariaLabelId, controlId),\n      ariaDescribedby: dropdownStatus.content ? footerId : undefined,\n      embedded,\n    }),\n    getOptionProps,\n    getTokenProps: () => ({ onDismiss: tokenOnDismiss }),\n    getDropdownProps: () => ({ ...getDropdownProps(), onMouseDown: dropdownOnMouseDown }),\n    getWrapperProps: () => ({ onKeyDown: wrapperOnKeyDown }),\n    highlightedIndex,\n  };\n}\n"]}