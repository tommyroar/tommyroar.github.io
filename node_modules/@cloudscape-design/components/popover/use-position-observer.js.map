{"version":3,"file":"use-position-observer.js","sourceRoot":"","sources":["../../../src/popover/use-position-observer.ts"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AACtC,0DAA0D;AAE1D,OAAO,EAAE,SAAS,EAAE,MAAM,OAAO,CAAC;AAElC,OAAO,EAAE,iBAAiB,EAAE,MAAM,+CAA+C,CAAC;AAOlF,MAAM,CAAC,OAAO,UAAU,mBAAmB,CACzC,QAA8B,EAC9B,QAAqC,EACrC,QAAoB;IAEpB,MAAM,cAAc,GAAG,iBAAiB,CAAC,QAAQ,CAAC,CAAC;IAEnD,SAAS,CAAC,GAAG,EAAE;QACb,MAAM,KAAK,GAAG,QAAQ,EAAE,CAAC;QACzB,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO;QACT,CAAC;QAED,IAAI,YAAY,GAAG,QAAQ,CAAC;QAE5B,IAAI,YAAY,GAAW;YACzB,CAAC,EAAE,KAAK,CAAC,qBAAqB,EAAE,CAAC,CAAC;YAClC,CAAC,EAAE,KAAK,CAAC,qBAAqB,EAAE,CAAC,CAAC;SACnC,CAAC;QAEF,MAAM,QAAQ,GAAG,IAAI,gBAAgB,CAAC,GAAG,EAAE;YACzC,MAAM,KAAK,GAAG,QAAQ,EAAE,CAAC;YACzB,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,OAAO;YACT,CAAC;YAED,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,KAAK,CAAC,qBAAqB,EAAE,CAAC;YAE/C,+EAA+E;YAC/E,IAAI,CAAC,KAAK,YAAY,CAAC,CAAC,IAAI,CAAC,KAAK,YAAY,CAAC,CAAC,IAAI,QAAQ,KAAK,YAAY,EAAE,CAAC;gBAC9E,YAAY,GAAG,QAAQ,CAAC;gBACxB,YAAY,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;gBACxB,cAAc,EAAE,CAAC;YACnB,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,mDAAmD;QACnD,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,aAAa,EAAE;YACpC,UAAU,EAAE,IAAI;YAChB,OAAO,EAAE,IAAI;YACb,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,OAAO,GAAG,EAAE,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;QACnC,uDAAuD;IACzD,CAAC,EAAE,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC,CAAC,CAAC,4HAA4H;AAC9J,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/* istanbul ignore file - Tested with integration tests */\n\nimport { useEffect } from 'react';\n\nimport { useStableCallback } from '@cloudscape-design/component-toolkit/internal';\n\ninterface Coords {\n  x?: number;\n  y?: number;\n}\n\nexport default function usePositionObserver(\n  getTrack: () => null | Element,\n  trackKey: string | number | undefined,\n  callback: () => void\n) {\n  const stableCallback = useStableCallback(callback);\n\n  useEffect(() => {\n    const track = getTrack();\n    if (!track) {\n      return;\n    }\n\n    let lastTrackKey = trackKey;\n\n    let lastPosition: Coords = {\n      x: track.getBoundingClientRect().x,\n      y: track.getBoundingClientRect().y,\n    };\n\n    const observer = new MutationObserver(() => {\n      const track = getTrack();\n      if (!track) {\n        return;\n      }\n\n      const { x, y } = track.getBoundingClientRect();\n\n      // Only trigger the callback when the position changes or the track key changes\n      if (x !== lastPosition.x || y !== lastPosition.y || trackKey !== lastTrackKey) {\n        lastTrackKey = trackKey;\n        lastPosition = { x, y };\n        stableCallback();\n      }\n    });\n\n    // Observe the entire ownerDocument for DOM changes\n    observer.observe(track.ownerDocument, {\n      attributes: true,\n      subtree: true,\n      childList: true,\n    });\n\n    return () => observer.disconnect();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [getTrack, stableCallback]); // trackKey excluded to avoid the observer being recreated everytime the value changes, causing rendering issues for Tooltip\n}\n"]}