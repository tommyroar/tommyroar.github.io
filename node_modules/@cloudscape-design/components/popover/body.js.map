{"version":3,"file":"body.js","sourceRoot":"","sources":["../../../src/popover/body.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useCallback, useEffect, useRef } from 'react';\nimport clsx from 'clsx';\n\nimport { useUniqueId } from '@cloudscape-design/component-toolkit/internal';\nimport { getAnalyticsMetadataAttribute } from '@cloudscape-design/component-toolkit/internal/analytics-metadata';\n\nimport { ButtonProps } from '../button/interfaces';\nimport { InternalButton } from '../button/internal';\nimport { BuiltInErrorBoundary } from '../error-boundary/internal';\nimport { useInternalI18n } from '../i18n/context';\nimport FocusLock from '../internal/components/focus-lock';\nimport { KeyCode } from '../internal/keycode';\n\nimport styles from './styles.css.js';\n\nexport interface PopoverBodyProps {\n  dismissButton: boolean;\n  dismissAriaLabel: string | undefined;\n  onDismiss: (() => void) | undefined;\n  onBlur?: (event: React.FocusEvent) => void;\n\n  header: React.ReactNode | undefined;\n  children: React.ReactNode;\n  variant?: 'annotation' | 'chart';\n  overflowVisible?: 'content' | 'both';\n\n  className?: string;\n  ariaLabelledby?: string;\n\n  closeAnalyticsAction?: string;\n}\n\nconst PopoverBody = React.forwardRef(\n  (\n    {\n      dismissButton: showDismissButton,\n      dismissAriaLabel,\n      header,\n      children,\n      onDismiss,\n      onBlur,\n      variant,\n      overflowVisible,\n      className,\n      ariaLabelledby,\n      closeAnalyticsAction,\n    }: PopoverBodyProps,\n    ref: React.Ref<HTMLDivElement>\n  ) => {\n    const i18n = useInternalI18n('popover');\n    const labelledById = useUniqueId('awsui-popover-');\n    const dismissButtonFocused = useRef(false);\n    const dismissButtonRef = useRef<ButtonProps.Ref>(null);\n\n    const onKeyDown = useCallback(\n      (event: React.KeyboardEvent) => {\n        if (event.keyCode === KeyCode.escape) {\n          event.stopPropagation();\n          onDismiss?.();\n        }\n      },\n      [onDismiss]\n    );\n\n    // Implement our own auto-focus rather than using FocusLock's,\n    // because we also want to focus the dismiss button when it\n    // is added dynamically (e.g. in chart popovers)\n    useEffect(() => {\n      if (showDismissButton && !dismissButtonFocused.current) {\n        dismissButtonRef.current?.focus({ preventScroll: true });\n      }\n      dismissButtonFocused.current = showDismissButton;\n    }, [showDismissButton]);\n\n    const dismissButton = (showDismissButton ?? null) && (\n      <div\n        className={styles.dismiss}\n        {...(closeAnalyticsAction ? getAnalyticsMetadataAttribute({ action: closeAnalyticsAction }) : {})}\n      >\n        <InternalButton\n          variant=\"icon\"\n          formAction=\"none\"\n          iconName=\"close\"\n          className={styles['dismiss-control']}\n          ariaLabel={i18n('dismissAriaLabel', dismissAriaLabel)}\n          onClick={() => onDismiss?.()}\n          ref={dismissButtonRef}\n        />\n      </div>\n    );\n\n    const isDialog = showDismissButton;\n    const shouldTrapFocus = showDismissButton && variant !== 'annotation';\n\n    const dialogProps = isDialog\n      ? {\n          role: 'dialog',\n          'aria-labelledby': ariaLabelledby ?? (header ? labelledById : undefined),\n        }\n      : {};\n\n    return (\n      <div\n        className={clsx(styles.body, styles[`body-variant-${variant}`], className, {\n          [styles['body-overflow-visible']]: overflowVisible === 'both',\n        })}\n        onKeyDown={onKeyDown}\n        ref={ref}\n        onBlur={onBlur}\n        {...dialogProps}\n      >\n        <BuiltInErrorBoundary>\n          <FocusLock disabled={!shouldTrapFocus} autoFocus={false}>\n            {header && (\n              <div className={clsx(styles['header-row'], showDismissButton && styles['has-dismiss'])}>\n                {dismissButton}\n                <div className={styles.header} id={labelledById}>\n                  <h2>{header}</h2>\n                </div>\n              </div>\n            )}\n            <div className={!header && showDismissButton ? styles['has-dismiss'] : undefined}>\n              {!header && dismissButton}\n              <div className={clsx(styles.content, { [styles['content-overflow-visible']]: !!overflowVisible })}>\n                {children}\n              </div>\n            </div>\n          </FocusLock>\n        </BuiltInErrorBoundary>\n      </div>\n    );\n  }\n);\n\nexport default PopoverBody;\n"]}