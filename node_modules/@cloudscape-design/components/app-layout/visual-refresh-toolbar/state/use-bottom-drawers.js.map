{"version":3,"file":"use-bottom-drawers.js","sourceRoot":"","sources":["../../../../../src/app-layout/visual-refresh-toolbar/state/use-bottom-drawers.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { MutableRefObject, useRef, useState } from 'react';\n\nimport { fireNonCancelableEvent } from '../../../internal/events';\nimport { DrawerPayload, WidgetMessage } from '../../../internal/plugins/widget/interfaces';\nimport { mapRuntimeConfigToAiDrawer } from '../../runtime-drawer';\n\nexport interface OnChangeParams {\n  initiatedByUserAction: boolean;\n}\n\nconst DEFAULT_ON_CHANGE_PARAMS = { initiatedByUserAction: true };\n\nconst MIN_DRAWER_SIZE = 400;\n\ninterface UseDrawersProps {\n  onBottomDrawerFocus: () => void;\n  expandedDrawerId: string | null;\n  setExpandedDrawerId: (value: string | null) => void;\n  drawersOpenQueue: MutableRefObject<Array<string>>;\n}\n\nexport function useBottomDrawers({\n  onBottomDrawerFocus,\n  expandedDrawerId,\n  setExpandedDrawerId,\n  drawersOpenQueue,\n}: UseDrawersProps) {\n  const [activeBottomDrawerId, setActiveBottomDrawerId] = useState<string | null>(null);\n  const [drawerSizes, setDrawerSizes] = useState<Record<string, number>>({});\n  const [runtimeBottomDrawers, setRuntimeBottomDrawers] = useState<Array<DrawerPayload>>([]);\n  const bottomDrawerWasOpenRef = useRef(false);\n  bottomDrawerWasOpenRef.current = bottomDrawerWasOpenRef.current || !!activeBottomDrawerId;\n  const bottomDrawers = runtimeBottomDrawers.map(mapRuntimeConfigToAiDrawer);\n\n  function onActiveBottomDrawerResize({ id, size }: { id: string; size: number }) {\n    setDrawerSizes(oldSizes => ({ ...oldSizes, [id]: size }));\n    fireNonCancelableEvent(activeBottomDrawer?.onResize, { id, size });\n  }\n\n  function onActiveBottomDrawerChange(\n    drawerId: string | null,\n    { initiatedByUserAction }: Partial<OnChangeParams> = DEFAULT_ON_CHANGE_PARAMS\n  ) {\n    const drawer = bottomDrawers.find(drawer => drawer.id === (drawerId || activeBottomDrawerId));\n    setActiveBottomDrawerId(drawerId);\n    fireNonCancelableEvent(drawer?.onToggle, { isOpen: !!drawerId, initiatedByUserAction });\n    if (activeBottomDrawerId === expandedDrawerId) {\n      setExpandedDrawerId(null);\n    }\n    if (drawerId) {\n      drawersOpenQueue.current = [drawerId, ...drawersOpenQueue.current];\n    } else {\n      drawersOpenQueue.current = drawersOpenQueue.current.filter(id => id !== activeBottomDrawerId);\n    }\n    onBottomDrawerFocus?.();\n  }\n\n  function bottomDrawersMessageHandler(event: WidgetMessage) {\n    if (event.type === 'registerBottomDrawer') {\n      if (bottomDrawers.find(drawer => drawer.id === event.payload.id)) {\n        return;\n      }\n      setRuntimeBottomDrawers(existingBottomDrawers => [...existingBottomDrawers, event.payload]);\n      if (!bottomDrawerWasOpenRef.current && event.payload.defaultActive) {\n        onActiveBottomDrawerChange(event.payload.id, { initiatedByUserAction: false });\n      }\n      return;\n    }\n\n    switch (event.type) {\n      case 'updateDrawerConfig':\n        setRuntimeBottomDrawers(existingBottomDrawers => {\n          return existingBottomDrawers.map(drawer => {\n            if (drawer.id === event.payload.id) {\n              return {\n                ...drawer,\n                ...event.payload,\n              };\n            }\n\n            return drawer;\n          });\n        });\n        break;\n      case 'openDrawer':\n        onActiveBottomDrawerChange(event.payload.id, { initiatedByUserAction: false });\n        break;\n      case 'closeDrawer':\n        onActiveBottomDrawerChange(null, { initiatedByUserAction: false });\n        break;\n      case 'resizeDrawer':\n        onActiveBottomDrawerResize({ id: event.payload.id, size: event.payload.size });\n        break;\n    }\n  }\n  const activeBottomDrawer = activeBottomDrawerId\n    ? bottomDrawers.find(drawer => drawer.id === activeBottomDrawerId)\n    : null;\n  const activeBottomDrawerSize = activeBottomDrawerId\n    ? (drawerSizes[activeBottomDrawerId] ?? activeBottomDrawer?.defaultSize ?? MIN_DRAWER_SIZE)\n    : 0;\n  const minBottomDrawerSize = Math.min(activeBottomDrawer?.defaultSize ?? MIN_DRAWER_SIZE, MIN_DRAWER_SIZE);\n\n  return {\n    bottomDrawers,\n    activeBottomDrawer,\n    onActiveBottomDrawerChange,\n    activeBottomDrawerSize,\n    minBottomDrawerSize,\n    onActiveBottomDrawerResize,\n    bottomDrawersMessageHandler,\n  };\n}\n"]}