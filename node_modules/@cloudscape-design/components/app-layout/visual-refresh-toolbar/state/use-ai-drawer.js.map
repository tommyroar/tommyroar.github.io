{"version":3,"file":"use-ai-drawer.js","sourceRoot":"","sources":["../../../../../src/app-layout/visual-refresh-toolbar/state/use-ai-drawer.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useRef, useState } from 'react';\n\nimport { fireNonCancelableEvent } from '../../../internal/events';\nimport { DrawerPayload as RuntimeAiDrawerConfig, WidgetMessage } from '../../../internal/plugins/widget/interfaces';\nimport { getLimitedValue } from '../../../split-panel/utils/size-utils';\nimport { mapRuntimeConfigToAiDrawer } from '../../runtime-drawer';\n\nexport interface OnChangeParams {\n  initiatedByUserAction: boolean;\n}\n\nconst DEFAULT_ON_CHANGE_PARAMS = { initiatedByUserAction: true };\n\nconst MIN_DRAWER_SIZE = 400;\n\ninterface UseDrawersProps {\n  onAiDrawerFocus: () => void;\n  expandedDrawerId: string | null;\n  setExpandedDrawerId: (value: string | null) => void;\n  getMaxAiDrawerSize: () => number;\n}\n\nexport function useAiDrawer({\n  onAiDrawerFocus,\n  expandedDrawerId,\n  setExpandedDrawerId,\n  getMaxAiDrawerSize,\n}: UseDrawersProps) {\n  const [runtimeDrawer, setRuntimeDrawer] = useState<RuntimeAiDrawerConfig | null>(null);\n  const [activeAiDrawerId, setActiveAiDrawerId] = useState<string | null>(null);\n  const [size, setSize] = useState<number | null>(null);\n  const aiDrawerWasOpenRef = useRef(false);\n  aiDrawerWasOpenRef.current = aiDrawerWasOpenRef.current || !!activeAiDrawerId;\n\n  function onActiveAiDrawerResize(size: number) {\n    const limitedSize = getLimitedValue(minAiDrawerSize, size, getMaxAiDrawerSize());\n    setSize(limitedSize);\n    fireNonCancelableEvent(activeAiDrawer?.onResize, { id: activeAiDrawerId, size: limitedSize });\n  }\n\n  function onActiveAiDrawerChange(\n    newDrawerId: string | null,\n    { initiatedByUserAction }: OnChangeParams = DEFAULT_ON_CHANGE_PARAMS\n  ) {\n    setActiveAiDrawerId(newDrawerId);\n\n    if (newDrawerId) {\n      fireNonCancelableEvent(runtimeDrawer?.onToggle, { isOpen: true, initiatedByUserAction });\n    }\n\n    if (activeAiDrawerId) {\n      fireNonCancelableEvent(runtimeDrawer?.onToggle, { isOpen: false, initiatedByUserAction });\n\n      if (activeAiDrawerId === expandedDrawerId) {\n        setExpandedDrawerId?.(null);\n      }\n    }\n\n    onAiDrawerFocus?.();\n  }\n\n  function aiDrawerMessageHandler(event: WidgetMessage) {\n    if (event.type === 'registerLeftDrawer') {\n      setRuntimeDrawer(event.payload);\n      if (!aiDrawerWasOpenRef.current && event.payload.defaultActive) {\n        onActiveAiDrawerChange(event.payload.id, { initiatedByUserAction: false });\n      }\n      return;\n    }\n\n    switch (event.type) {\n      case 'updateDrawerConfig':\n        setRuntimeDrawer(current => (current ? { ...current, ...event.payload } : current));\n        break;\n      case 'openDrawer':\n        onActiveAiDrawerChange(event.payload.id, { initiatedByUserAction: false });\n        break;\n      case 'closeDrawer':\n        onActiveAiDrawerChange(null, { initiatedByUserAction: false });\n        break;\n      case 'resizeDrawer':\n        onActiveAiDrawerResize(event.payload.size);\n        break;\n    }\n  }\n\n  const aiDrawer = runtimeDrawer && mapRuntimeConfigToAiDrawer(runtimeDrawer);\n  const activeAiDrawer = activeAiDrawerId && activeAiDrawerId === aiDrawer?.id ? aiDrawer : null;\n  const activeAiDrawerSize = activeAiDrawerId ? (size ?? activeAiDrawer?.defaultSize ?? MIN_DRAWER_SIZE) : 0;\n  const minAiDrawerSize = Math.min(activeAiDrawer?.defaultSize ?? MIN_DRAWER_SIZE, MIN_DRAWER_SIZE);\n\n  return {\n    aiDrawer,\n    aiDrawerMessageHandler,\n    onActiveAiDrawerChange,\n    activeAiDrawer,\n    activeAiDrawerId,\n    activeAiDrawerSize,\n    minAiDrawerSize,\n    onActiveAiDrawerResize,\n  };\n}\n"]}