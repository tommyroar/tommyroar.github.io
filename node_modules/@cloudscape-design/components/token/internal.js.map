{"version":3,"file":"internal.js","sourceRoot":"","sources":["../../../src/token/internal.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { useRef, useState } from 'react';\nimport clsx from 'clsx';\n\nimport { useResizeObserver, useUniqueId, warnOnce } from '@cloudscape-design/component-toolkit/internal';\n\nimport { getBaseProps } from '../internal/base-component';\nimport Option from '../internal/components/option';\nimport { InternalBaseComponentProps } from '../internal/hooks/use-base-component';\nimport LiveRegion from '../live-region/internal';\nimport Tooltip from '../tooltip/internal.js';\nimport DismissButton from './dismiss-button';\nimport { TokenProps } from './interfaces';\n\nimport legacyTestingStyles from '../token-group/styles.css.js';\nimport analyticsSelectors from './analytics-metadata/styles.css.js';\nimport styles from './styles.css.js';\nimport testUtilStyles from './test-classes/styles.css.js';\n\ntype InternalTokenProps = TokenProps &\n  InternalBaseComponentProps & {\n    role?: string;\n    disableInnerPadding?: boolean;\n  };\n\nfunction InternalToken({\n  // External\n  label,\n  ariaLabel,\n  labelTag,\n  description,\n  variant = 'normal',\n  disabled,\n  readOnly,\n  icon,\n  tags,\n  dismissLabel,\n  onDismiss,\n  tooltipContent,\n\n  // Internal\n  role,\n  disableInnerPadding,\n\n  // Base\n  __internalRootRef,\n  ...restProps\n}: InternalTokenProps) {\n  const baseProps = getBaseProps(restProps);\n  const labelContainerRef = useRef<HTMLSpanElement>(null);\n  const labelRef = useRef<HTMLSpanElement>(null);\n  const [showTooltip, setShowTooltip] = useState(false);\n  const [isEllipsisActive, setIsEllipsisActive] = useState(false);\n  const isInline = variant === 'inline';\n  const ariaLabelledbyId = useUniqueId();\n\n  const isLabelOverflowing = () => {\n    const labelContent = labelRef.current;\n    const labelContainer = labelContainerRef.current;\n\n    if (labelContent && labelContainer) {\n      return labelContent.offsetWidth > labelContainer.offsetWidth;\n    }\n  };\n\n  useResizeObserver(labelContainerRef, () => {\n    if (isInline) {\n      setIsEllipsisActive(isLabelOverflowing() ?? false);\n    }\n  });\n\n  const buildOptionDefinition = () => {\n    const isLabelStringOrNumber = typeof label === 'string' || typeof label === 'number';\n    const labelObject = isLabelStringOrNumber ? { label: String(label) } : { labelContent: label };\n\n    if (isInline) {\n      if (!isLabelStringOrNumber) {\n        warnOnce('Label', `Only plain text (strings or numbers) are supported when variant=\"inline\".`);\n      }\n\n      return {\n        ...labelObject,\n        disabled,\n        __customIcon: icon && <span className={clsx(styles.icon, styles['icon-inline'])}>{icon}</span>,\n      };\n    } else {\n      return {\n        ...labelObject,\n        disabled,\n        labelTag,\n        description,\n        tags,\n        __customIcon: icon && <span className={styles.icon}>{icon}</span>,\n      };\n    }\n  };\n\n  return (\n    <div\n      {...baseProps}\n      ref={__internalRootRef}\n      className={clsx(\n        styles.root,\n        legacyTestingStyles.token,\n        testUtilStyles.root,\n        !isInline ? styles['token-normal'] : styles['token-inline'],\n        analyticsSelectors.token,\n        baseProps.className\n      )}\n      aria-label={ariaLabel}\n      aria-labelledby={!ariaLabel ? ariaLabelledbyId : undefined}\n      aria-disabled={!!disabled}\n      role={role ?? 'group'}\n      onFocus={() => {\n        setShowTooltip(true);\n      }}\n      onBlur={() => {\n        setShowTooltip(false);\n      }}\n      onMouseEnter={() => {\n        setShowTooltip(true);\n      }}\n      onMouseLeave={() => {\n        setShowTooltip(false);\n      }}\n      tabIndex={!!tooltipContent && isInline && isEllipsisActive ? 0 : undefined}\n    >\n      <div\n        className={clsx(\n          !isInline ? styles['token-box'] : styles['token-box-inline'],\n          disabled && styles['token-box-disabled'],\n          readOnly && styles['token-box-readonly'],\n          !isInline && !onDismiss && styles['token-box-without-dismiss'],\n          disableInnerPadding && styles['disable-padding']\n        )}\n      >\n        <Option\n          className={clsx(isInline && styles['token-option-inline'])}\n          triggerVariant={isInline}\n          option={buildOptionDefinition()}\n          disableTitleTooltip={!!tooltipContent}\n          labelContainerRef={labelContainerRef}\n          labelRef={labelRef}\n          labelId={ariaLabelledbyId}\n        />\n        {onDismiss && (\n          <DismissButton\n            disabled={disabled}\n            dismissLabel={dismissLabel}\n            onDismiss={onDismiss}\n            readOnly={readOnly}\n            inline={isInline}\n          />\n        )}\n      </div>\n      {!!tooltipContent && isInline && isEllipsisActive && showTooltip && (\n        <Tooltip\n          data-testid=\"token-tooltip\"\n          getTrack={() => labelContainerRef.current}\n          content={\n            <LiveRegion>\n              <span data-testid=\"tooltip-live-region-content\">{tooltipContent}</span>\n            </LiveRegion>\n          }\n          onEscape={() => {\n            setShowTooltip(false);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default InternalToken;\n"]}