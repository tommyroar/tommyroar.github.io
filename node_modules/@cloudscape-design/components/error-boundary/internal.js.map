{"version":3,"file":"internal.js","sourceRoot":"","sources":["../../../src/error-boundary/internal.tsx"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AAEtC,OAAO,KAAK,EAAE,EAAE,SAAS,EAAE,aAAa,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAE9E,OAAO,EAAE,YAAY,EAAE,MAAM,+CAA+C,CAAC;AAI7E,OAAO,EAAE,qBAAqB,EAAE,MAAM,YAAY,CAAC;AAGnD,OAAO,MAAM,MAAM,iBAAiB,CAAC;AASrC,MAAM,cAAc,GAAG,MAAM,EAAE,CAAC;AAEhC,MAAM,sBAAsB,GAAG,aAAa,CAI1C;IACA,OAAO,EAAE,GAAG,EAAE,GAAE,CAAC;IACjB,UAAU,EAAE,cAAc;CAC3B,CAAC,CAAC;AAMH,MAAM,UAAU,qBAAqB,CAAC,EACpC,QAAQ,EACR,cAAc,EACd,YAAY,EACZ,iBAAiB,EACjB,GAAG,KAAK,EACmB;IAC3B,MAAM,OAAO,GAAG,UAAU,CAAC,sBAAsB,CAAC,CAAC;IACnD,MAAM,cAAc,GAAG,OAAO,CAAC,UAAU,KAAK,IAAI,IAAI,YAAY,CAAC;IACnE,MAAM,cAAc,GAAG,cAAc,IAAI,cAAc,CAAC;IAExD,MAAM,CAAC,WAAW,EAAE,cAAc,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IACtD,MAAM,UAAU,GAAG,CAAC,IAA2B,EAAE,EAAE;QACjD,IAAI,IAAI,EAAE,CAAC;YACT,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;gBACpB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;YACtB,CAAC;YACD,IAAI,CAAC,SAAS,CAAC,UAAU,GAAG,GAAG,EAAE,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;YACvD,IAAI,CAAC,SAAS,CAAC,gBAAgB,GAAG,GAAG,EAAE,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;QAChE,CAAC;IACH,CAAC,CAAC;IACF,MAAM,SAAS,GAAG,YAAY,CAAC,UAAU,EAAE,iBAAiB,CAAC,CAAC;IAE9D,OAAO,CACL,6BAAK,GAAG,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,CAAC,gBAAgB,CAAC,4BAA0B,KAAK,CAAC,eAAe,IACpG,CAAC,cAAc,CAAC,CAAC,CAAC,CACjB,oBAAC,iBAAiB,OAAK,KAAK,EAAE,WAAW,EAAE,WAAW;QACpD,oBAAC,sBAAsB,CAAC,QAAQ,IAAC,KAAK,EAAE,EAAE,GAAG,KAAK,EAAE,UAAU,EAAE,cAAc,EAAE,IAC7E,QAAQ,CACuB,CAChB,CACrB,CAAC,CAAC,CAAC,CACF,0CAAG,QAAQ,CAAI,CAChB,CACG,CACP,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,oBAAoB,CAAC,EAAE,OAAO,EAAE,cAAc,GAAG,KAAK,EAAE,QAAQ,EAA6B;IAC3G,MAAM,OAAO,GAAG,UAAU,CAAC,sBAAsB,CAAC,CAAC;IACnD,MAAM,cAAc,GAAG,OAAO,CAAC,UAAU,KAAK,IAAI,IAAI,OAAO,CAAC,UAAU,KAAK,cAAc,CAAC;IAC5F,MAAM,cAAc,GAAG,cAAc,IAAI,cAAc,CAAC;IACxD,OAAO,CAAC,cAAc,CAAC,CAAC,CAAC,CACvB,oBAAC,iBAAiB,OAAK,OAAO,EAAE,OAAO,EAAE,OAAO;QAC9C,oBAAC,sBAAsB,CAAC,QAAQ,IAAC,KAAK,EAAE,EAAE,GAAG,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,IAC/E,QAAQ,CACuB,CAChB,CACrB,CAAC,CAAC,CAAC,CACF,0CAAG,QAAQ,CAAI,CAChB,CAAC;AACJ,CAAC;AAWD,MAAM,iBAAkB,SAAQ,SAAqD;IACnF,YAAY,KAA6B;QACvC,KAAK,CAAC,KAAK,CAAC,CAAC;QACb,IAAI,CAAC,KAAK,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;IACnC,CAAC;IAED,MAAM,CAAC,wBAAwB;QAC7B,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;IAC5B,CAAC;IAED,iBAAiB,CAAC,KAAY,EAAE,SAA0B;;QACxD,MAAA,MAAA,IAAI,CAAC,KAAK,EAAC,OAAO,mDAAG,EAAE,KAAK,EAAE,SAAS,EAAE,eAAe,EAAE,IAAI,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC;IAC1F,CAAC;IAED,MAAM;;QACJ,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;YAClD,MAAM,QAAQ,GAAG,oBAAC,qBAAqB,OAAK,IAAI,CAAC,KAAK,GAAI,CAAC;YAC3D,OAAO,MAAA,MAAA,MAAA,IAAI,CAAC,KAAK,EAAC,OAAO,mDAAG,QAAQ,CAAC,mCAAI,QAAQ,CAAC;QACpD,CAAC;QACD,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;IAC7B,CAAC;CACF","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { Component, createContext, useContext, useState } from 'react';\n\nimport { useMergeRefs } from '@cloudscape-design/component-toolkit/internal';\n\nimport { InternalBaseComponentProps } from '../internal/hooks/use-base-component';\nimport { SomeRequired } from '../internal/types';\nimport { ErrorBoundaryFallback } from './fallback';\nimport { BuiltInErrorBoundaryProps, ErrorBoundaryProps } from './interfaces';\n\nimport styles from './styles.css.js';\n\n// Helper methods attached to the component's root node for e2e testing.\ndeclare global {\n  interface HTMLElement {\n    __awsui__?: { forceError?(): void; clearForcedError?(): void };\n  }\n}\n\nconst RootSuppressed = Symbol();\n\nconst ErrorBoundariesContext = createContext<\n  Pick<ErrorBoundaryProps, 'renderFallback' | 'i18nStrings' | 'onError' | 'errorBoundaryId'> & {\n    suppressed: boolean | typeof RootSuppressed;\n  }\n>({\n  onError: () => {},\n  suppressed: RootSuppressed,\n});\n\ninterface InternalErrorBoundaryProps\n  extends SomeRequired<ErrorBoundaryProps, 'suppressNested' | 'suppressible'>,\n    InternalBaseComponentProps {}\n\nexport function InternalErrorBoundary({\n  children,\n  suppressNested,\n  suppressible,\n  __internalRootRef,\n  ...props\n}: InternalErrorBoundaryProps) {\n  const context = useContext(ErrorBoundariesContext);\n  const thisSuppressed = context.suppressed === true && suppressible;\n  const nextSuppressed = suppressNested || thisSuppressed;\n\n  const [forcedError, setForcedError] = useState(false);\n  const setElement = (node: null | HTMLDivElement) => {\n    if (node) {\n      if (!node.__awsui__) {\n        node.__awsui__ = {};\n      }\n      node.__awsui__.forceError = () => setForcedError(true);\n      node.__awsui__.clearForcedError = () => setForcedError(false);\n    }\n  };\n  const mergedRef = useMergeRefs(setElement, __internalRootRef);\n\n  return (\n    <div ref={mergedRef} className={styles['error-boundary']} data-awsui-boundary-id={props.errorBoundaryId}>\n      {!thisSuppressed ? (\n        <ErrorBoundaryImpl {...props} forcedError={forcedError}>\n          <ErrorBoundariesContext.Provider value={{ ...props, suppressed: nextSuppressed }}>\n            {children}\n          </ErrorBoundariesContext.Provider>\n        </ErrorBoundaryImpl>\n      ) : (\n        <>{children}</>\n      )}\n    </div>\n  );\n}\n\nexport function BuiltInErrorBoundary({ wrapper, suppressNested = false, children }: BuiltInErrorBoundaryProps) {\n  const context = useContext(ErrorBoundariesContext);\n  const thisSuppressed = context.suppressed === true || context.suppressed === RootSuppressed;\n  const nextSuppressed = suppressNested || thisSuppressed;\n  return !thisSuppressed ? (\n    <ErrorBoundaryImpl {...context} wrapper={wrapper}>\n      <ErrorBoundariesContext.Provider value={{ ...context, suppressed: nextSuppressed }}>\n        {children}\n      </ErrorBoundariesContext.Provider>\n    </ErrorBoundaryImpl>\n  ) : (\n    <>{children}</>\n  );\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n}\n\ninterface ErrorBoundaryImplProps extends ErrorBoundaryProps {\n  wrapper?: (content: React.ReactNode) => React.ReactNode;\n  forcedError?: boolean;\n}\n\nclass ErrorBoundaryImpl extends Component<ErrorBoundaryImplProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryImplProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError() {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\n    this.props.onError?.({ error, errorInfo, errorBoundaryId: this.props.errorBoundaryId });\n  }\n\n  render() {\n    if (this.state.hasError || this.props.forcedError) {\n      const fallback = <ErrorBoundaryFallback {...this.props} />;\n      return this.props.wrapper?.(fallback) ?? fallback;\n    }\n    return this.props.children;\n  }\n}\n"]}