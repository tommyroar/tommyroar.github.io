{"version":3,"file":"fallback.js","sourceRoot":"","sources":["../../../src/error-boundary/fallback.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React from 'react';\nimport clsx from 'clsx';\nimport IntlMessageFormat from 'intl-messageformat';\n\nimport InternalAlert from '../alert/internal';\nimport InternalButton from '../button/internal';\nimport { useInternalI18n } from '../i18n/context';\nimport { getBaseProps } from '../internal/base-component';\nimport { ErrorBoundaryProps } from './interfaces';\nimport { canUseRefresh, refreshPage } from './utils';\n\nimport styles from './styles.css.js';\nimport testUtilStyles from './test-classes/styles.css.js';\n\nexport function ErrorBoundaryFallback({\n  i18nStrings = {},\n  renderFallback,\n  ...props\n}: Pick<ErrorBoundaryProps, 'renderFallback' | 'i18nStrings'>) {\n  const baseProps = getBaseProps(props);\n  const defaultSlots = {\n    header: (\n      <div className={clsx(styles.header, testUtilStyles.header)}>\n        <DefaultHeaderContent i18nStrings={i18nStrings} />\n      </div>\n    ),\n    description: (\n      <div className={clsx(styles.description, testUtilStyles.description)}>\n        <DefaultDescriptionContent i18nStrings={i18nStrings} />\n      </div>\n    ),\n    action: canUseRefresh() ? (\n      <div className={clsx(styles.action, testUtilStyles.action)}>\n        <DefaultActionContent i18nStrings={i18nStrings} />\n      </div>\n    ) : null,\n  };\n  return (\n    <div {...baseProps} className={clsx(baseProps.className, testUtilStyles.fallback)}>\n      {renderFallback?.(defaultSlots) ?? (\n        <InternalAlert type=\"error\" header={defaultSlots.header} action={defaultSlots.action}>\n          {defaultSlots.description}\n        </InternalAlert>\n      )}\n    </div>\n  );\n}\n\nfunction DefaultHeaderContent({ i18nStrings }: { i18nStrings: ErrorBoundaryProps.I18nStrings }) {\n  const i18n = useInternalI18n('error-boundary');\n  return <>{i18n('i18nStrings.headerText', i18nStrings?.headerText)}</>;\n}\n\nfunction DefaultDescriptionContent({\n  i18nStrings: { descriptionText, components: { Feedback } = {} } = {},\n}: {\n  i18nStrings: ErrorBoundaryProps.I18nStrings;\n}) {\n  const i18n = useInternalI18n('error-boundary');\n\n  // Dependencies for the intl-format function, where the pseudo-tags are declared as functions from parsed chunks.\n  const formatArgs = Feedback\n    ? {\n        hasFeedback: true,\n        Feedback: (chunks: React.ReactNode[]) => (\n          <span className={testUtilStyles['feedback-action']}>\n            <Feedback>{chunks[0] ?? ''}</Feedback>\n          </span>\n        ),\n      }\n    : { hasFeedback: false, Feedback: () => <></> };\n\n  // This ensures that the description string provided via i18nStrings also supports the <Feedback> injection,\n  // because the i18n() helper propagates the second argument as is, without applying intl-format to it.\n  // We wrap the format with try-catch to avoid intl errors caused by incorrectly referenced components.\n  function safeFormat(descriptionText?: string) {\n    try {\n      return descriptionText ? new IntlMessageFormat(descriptionText).format(formatArgs) : undefined;\n    } catch {\n      return descriptionText;\n    }\n  }\n  const message = i18n('i18nStrings.descriptionText', safeFormat(descriptionText), format => format(formatArgs));\n\n  // When the description includes <Feedback>, then the translated message is represented as an array of strings and\n  // React elements that require keys when rendering to avoid React warnings.\n  return (\n    <>\n      {Array.isArray(message) ? message.map((chunk, i) => <React.Fragment key={i}>{chunk}</React.Fragment>) : message}\n    </>\n  );\n}\n\nfunction DefaultActionContent({ i18nStrings }: { i18nStrings?: ErrorBoundaryProps.I18nStrings }) {\n  const i18n = useInternalI18n('error-boundary');\n  return (\n    <InternalButton iconName=\"refresh\" onClick={refreshPage} className={testUtilStyles['refresh-action']}>\n      {i18n('i18nStrings.refreshActionText', i18nStrings?.refreshActionText)}\n    </InternalButton>\n  );\n}\n"]}