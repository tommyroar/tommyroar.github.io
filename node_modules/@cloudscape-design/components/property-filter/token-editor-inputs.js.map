{"version":3,"file":"token-editor-inputs.js","sourceRoot":"","sources":["../../../src/property-filter/token-editor-inputs.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React from 'react';\n\nimport InternalAutosuggest from '../autosuggest/internal.js';\nimport { DropdownStatusProps } from '../internal/components/dropdown-status/interfaces.js';\nimport { NonCancelableEventHandler } from '../internal/events/index.js';\nimport InternalMultiselect from '../multiselect/internal.js';\nimport { SelectProps } from '../select/interfaces.js';\nimport InternalSelect from '../select/internal.js';\nimport { getAllowedOperators, getPropertySuggestions } from './controller.js';\nimport { I18nStringsInternal, operatorToDescription } from './i18n-utils.js';\nimport {\n  ComparisonOperator,\n  GroupText,\n  InternalFilteringOption,\n  InternalFilteringProperty,\n  InternalFreeTextFiltering,\n  LoadItemsDetail,\n} from './interfaces.js';\nimport { useLoadItems } from './use-load-items.js';\n\nimport styles from './styles.css.js';\n\ninterface PropertyInputProps {\n  asyncProps: null | DropdownStatusProps;\n  customGroupsText: readonly GroupText[];\n  freeTextFiltering: InternalFreeTextFiltering;\n  filteringProperties: readonly InternalFilteringProperty[];\n  i18nStrings: I18nStringsInternal;\n  onChangePropertyKey: (propertyKey: undefined | string) => void;\n  onLoadItems?: NonCancelableEventHandler<LoadItemsDetail>;\n  property: null | InternalFilteringProperty;\n}\n\nexport function PropertyInput({\n  property,\n  onChangePropertyKey,\n  asyncProps,\n  filteringProperties,\n  onLoadItems,\n  customGroupsText,\n  i18nStrings,\n  freeTextFiltering,\n}: PropertyInputProps) {\n  const propertySelectHandlers = useLoadItems(onLoadItems);\n  const asyncPropertySelectProps = asyncProps ? { ...asyncProps, ...propertySelectHandlers } : {};\n  const propertyOptions: (SelectProps.Option | SelectProps.OptionGroup)[] = getPropertySuggestions(\n    filteringProperties,\n    customGroupsText,\n    i18nStrings,\n    ({ propertyKey, propertyLabel }) => ({\n      value: propertyKey,\n      label: propertyLabel,\n      dontCloseOnSelect: true,\n    })\n  );\n\n  const allPropertiesOption = {\n    label: i18nStrings.allPropertiesLabel,\n    value: undefined,\n  };\n  if (!freeTextFiltering.disabled) {\n    propertyOptions.unshift(allPropertiesOption);\n  }\n  return (\n    <InternalSelect\n      filteringType=\"auto\"\n      options={propertyOptions}\n      selectedOption={\n        property\n          ? {\n              value: property.propertyKey ?? undefined,\n              label: property.propertyLabel,\n            }\n          : allPropertiesOption\n      }\n      onChange={e => onChangePropertyKey(e.detail.selectedOption.value)}\n      {...asyncPropertySelectProps}\n    />\n  );\n}\n\ninterface OperatorInputProps {\n  i18nStrings: I18nStringsInternal;\n  onChangeOperator: (operator: ComparisonOperator) => void;\n  operator: undefined | ComparisonOperator;\n  property: null | InternalFilteringProperty;\n  freeTextFiltering: InternalFreeTextFiltering;\n  triggerVariant: 'option' | 'label';\n}\n\nexport function OperatorInput({\n  property,\n  operator,\n  onChangeOperator,\n  i18nStrings,\n  freeTextFiltering,\n  triggerVariant,\n}: OperatorInputProps) {\n  const operatorOptions = (property ? getAllowedOperators(property) : freeTextFiltering.operators).map(operator => ({\n    value: operator,\n    label: operator,\n    description: operatorToDescription(operator, i18nStrings),\n  }));\n  return (\n    <InternalSelect\n      options={operatorOptions}\n      triggerVariant={triggerVariant}\n      selectedOption={\n        operator\n          ? {\n              value: operator,\n              label: operator,\n              description: operatorToDescription(operator, i18nStrings),\n            }\n          : null\n      }\n      onChange={e => onChangeOperator(e.detail.selectedOption.value as ComparisonOperator)}\n    />\n  );\n}\n\ninterface ValueInputProps {\n  asyncProps: DropdownStatusProps;\n  filteringOptions: readonly InternalFilteringOption[];\n  i18nStrings: I18nStringsInternal;\n  onChangeValue: (value: unknown) => void;\n  onLoadItems?: NonCancelableEventHandler<LoadItemsDetail>;\n  operator: undefined | ComparisonOperator;\n  property: null | InternalFilteringProperty;\n  value: unknown;\n}\n\nexport function ValueInput(props: ValueInputProps) {\n  const { property, operator, value, onChangeValue } = props;\n  const OperatorForm = property?.propertyKey && operator && property?.getValueFormRenderer(operator);\n\n  if (OperatorForm) {\n    return <OperatorForm value={value} onChange={onChangeValue} operator={operator} />;\n  }\n  if (property && operator && property.getTokenType(operator) === 'enum') {\n    return <ValueInputEnum {...props} property={property} operator={operator} />;\n  }\n  return <ValueInputAuto {...props} />;\n}\n\nfunction ValueInputAuto({\n  property,\n  operator,\n  value: unknownValue,\n  onChangeValue,\n  asyncProps,\n  filteringOptions,\n  onLoadItems,\n  i18nStrings,\n}: ValueInputProps) {\n  const value = (unknownValue ?? '') + '';\n  const valueOptions = property\n    ? filteringOptions\n        .filter(option => option.property?.propertyKey === property.propertyKey)\n        .map(({ label, value, tags, filteringTags }) => ({ label, value, tags, filteringTags }))\n    : [];\n\n  const valueAutosuggestHandlers = useLoadItems(onLoadItems, '', property?.externalProperty, value, operator);\n  const asyncValueAutosuggestProps = property?.propertyKey\n    ? { ...valueAutosuggestHandlers, ...asyncProps }\n    : { empty: asyncProps.empty };\n  const [matchedOption] = valueOptions.filter(option => option.value === value);\n\n  return (\n    <InternalAutosuggest\n      enteredTextLabel={i18nStrings.enteredTextLabel}\n      value={matchedOption?.label ?? value}\n      clearAriaLabel={i18nStrings.clearAriaLabel}\n      onChange={e => onChangeValue(e.detail.value)}\n      disabled={!operator}\n      options={valueOptions}\n      {...asyncValueAutosuggestProps}\n      virtualScroll={true}\n    />\n  );\n}\n\ninterface ValueInputPropsEnum extends ValueInputProps {\n  property: InternalFilteringProperty;\n  operator: ComparisonOperator;\n}\n\nfunction ValueInputEnum({\n  property,\n  operator,\n  value: unknownValue,\n  onChangeValue,\n  asyncProps,\n  filteringOptions,\n  onLoadItems,\n}: ValueInputPropsEnum) {\n  const valueOptions = filteringOptions\n    .filter(option => option.property?.propertyKey === property.propertyKey)\n    .map(({ label, value, tags, filteringTags }) => ({ label, value, tags, filteringTags }));\n  const valueAutosuggestHandlers = useLoadItems(onLoadItems, '', property.externalProperty, undefined, operator);\n  const asyncValueAutosuggestProps = { statusType: 'finished' as const, ...valueAutosuggestHandlers, ...asyncProps };\n  const value = !unknownValue ? [] : Array.isArray(unknownValue) ? unknownValue : [unknownValue];\n  const selectedOptions = valueOptions.filter(option => value.includes(option.value));\n  return (\n    <div className={styles['token-editor-multiselect-wrapper']}>\n      <div className={styles['token-editor-multiselect-wrapper-inner']}>\n        <InternalMultiselect\n          filteringType=\"auto\"\n          selectedOptions={selectedOptions}\n          onChange={e => onChangeValue(e.detail.selectedOptions.map(o => o.value))}\n          options={valueOptions.length > 0 ? [{ options: valueOptions, label: property.groupValuesLabel }] : []}\n          {...asyncValueAutosuggestProps}\n          inlineTokens={true}\n          hideTokens={true}\n          keepOpen={true}\n        />\n      </div>\n    </div>\n  );\n}\n"]}